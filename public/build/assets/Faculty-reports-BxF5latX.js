import{r as i,j as e,t as O,a as B}from"./app-YUBFmmkD.js";import{B as b}from"./button-C91vRV6m.js";import{C as oe,a as ne}from"./card--mAECjEB.js";import{S as ie,a as ce,b as de,c as pe}from"./avatar-DqRBvoVy.js";import"./sweetalert2.esm.all-BQIkj5Wb.js";import{N as he}from"./Notification-D7_D5c14.js";import{L as $}from"./label-DWlplljF.js";import{D as U,a as H,b as G,c as K}from"./dialog-P3pw8xMk.js";import{T as me,a as xe,b as q,c,d as ue,e as n}from"./table-C-mDuAed.js";import{B as je,a as be,b as ge,c as X,d as fe}from"./breadcrumb-51dviZK3.js";import{A as Ne}from"./app-sidebar-D4hM-fDd.js";import{I as J}from"./input-DMTsWxkm.js";import{P as ve,a as ye,b as Ce}from"./popover-DNvxC4ay.js";import{S as C,a as R,b as S,c as w,d as u}from"./select-u-bK85VA.js";import{P as Re}from"./printer-C4AQJDwa.js";import{C as Q}from"./circle-check-DfrTejv4.js";import{F as Se}from"./funnel-BffxzxG6.js";import{X as Y}from"./index-Gm0W8oDU.js";import"./index-B9WTe5m5.js";import"./utils-CBfrqCZ4.js";import"./index-BPW6BtHW.js";import"./index-BlGL5JJv.js";import"./dropdown-menu--1b41bIH.js";import"./index-_7Mq37l_.js";import"./createLucideIcon-OmS0RfaO.js";import"./chevron-right-B6WwSfBh.js";import"./index-e0LgWcjC.js";import"./index-X8pKkW1m.js";import"./bell-DdP6RJhv.js";import"./house-B1p8JrSE.js";import"./user-cWiTbXyz.js";import"./log-out-Bv586FUR.js";import"./keyboard-D5IXjQLr.js";import"./boxes-CFhg2yIv.js";import"./users-CNeXSBet.js";import"./chevron-down-D-BXn-Gx.js";import"./index-0KkAnick.js";function we({filters:r,filterOptions:g,onApplyFilters:D,onResetFilters:p}){const[j,h]=i.useState(""),[f,d]=i.useState("");i.useEffect(()=>{r.condition?(h("condition"),d(r.condition)):r.room?(h("room"),d(r.room)):r.faculty?(h("faculty"),d(r.faculty)):r.reportable_type?(h("reportable_type"),d(r.reportable_type)):(h(""),d(""))},[r]);const v=s=>{const m=s==="all"?"":s;d(m);let N={...r};j&&(N[j]=m),D(N)},_=()=>{h(""),d(""),p()},k=[{value:"condition",label:"Condition"},{value:"room",label:"Room"},{value:"faculty",label:"Faculty"},{value:"reportable_type",label:"Report Type"}];return e.jsxs(ve,{children:[e.jsx(ye,{asChild:!0,children:e.jsxs(b,{className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",children:[e.jsx(Se,{className:"h-4 w-4"}),"Filter",(r.condition||r.room||r.faculty||r.reportable_type)&&e.jsx(Y,{className:"h-4 w-4 ml-1 cursor-pointer",onClick:s=>{s.stopPropagation(),s.preventDefault(),_()}})]})}),e.jsxs(Ce,{className:"w-[calc(100vw-2rem)] sm:w-[400px] p-4",children:[e.jsx("h4",{className:"font-medium mb-3 text-lg",children:"Filter Options"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(C,{value:j,onValueChange:s=>{h(s),d("")},children:[e.jsx(R,{className:"w-full",children:e.jsx(S,{placeholder:"Select Field"})}),e.jsx(w,{children:k.map(s=>e.jsx(u,{value:s.value,children:s.label},s.value))})]}),j==="condition"&&e.jsxs(C,{value:f||"all",onValueChange:v,children:[e.jsx(R,{className:"w-full",children:e.jsx(S,{placeholder:"Select Condition"})}),e.jsxs(w,{children:[e.jsx(u,{value:"all",children:"All"}),g.conditions.map((s,m)=>e.jsx(u,{value:s,children:s},m))]})]}),j==="room"&&e.jsxs(C,{value:f||"all",onValueChange:v,children:[e.jsx(R,{className:"w-full",children:e.jsx(S,{placeholder:"Select Room"})}),e.jsxs(w,{children:[e.jsx(u,{value:"all",children:"All"}),Object.entries(g.rooms).map(([s,m])=>e.jsxs(u,{value:s,children:["Room ",m]},s))]})]}),j==="faculty"&&e.jsxs(C,{value:f||"all",onValueChange:v,children:[e.jsx(R,{className:"w-full",children:e.jsx(S,{placeholder:"Select Faculty"})}),e.jsxs(w,{children:[e.jsx(u,{value:"all",children:"All"}),Object.entries(g.faculties).map(([s,m])=>e.jsx(u,{value:s,children:m},s))]})]}),j==="reportable_type"&&e.jsxs(C,{value:f||"all",onValueChange:v,children:[e.jsx(R,{className:"w-full",children:e.jsx(S,{placeholder:"Select Type"})}),e.jsxs(w,{children:[e.jsx(u,{value:"all",children:"All"}),g.reportable_types.map(s=>e.jsx(u,{value:s,children:s},s))]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{size:"sm",variant:"outline",onClick:_,className:"w-auto px-3",children:[e.jsx(Y,{className:"mr-1 h-4 w-4"})," Reset"]})})]})]})]})}function dt({reports:r,filters:g={},filterOptions:D}){const[p,j]=i.useState(r),[h,f]=i.useState(g.search||""),[d,v]=i.useState(null),[_,k]=i.useState(!1),s=t=>{v(t),k(!0)},[m,N]=i.useState(!1),[l,V]=i.useState(r),[F,P]=i.useState(""),[E,A]=i.useState(""),[T,Z]=i.useState(!1),ee=t=>{V(t),P(t.condition),A(""),N(!0)},te=t=>{if(!F){O.warning("Select Condition",{description:"Please select a new condition before resolving.",duration:2500});return}Z(!0),B.post(`/admin/faculty-reports/${t.id}/resolve`,{report_id:t.id,old_condition:t.condition,new_condition:F,details:E},{onSuccess:()=>{N(!1),V(null),P(""),A(""),O.success("Resolved!",{description:`Report #${t.id} has been successfully resolved.`,duration:2e3}),j(o=>o.map(a=>a.id===t.id?{...a,resolved:!0,condition:F}:a))},onError:()=>{O.error("Error",{description:"Failed to resolve report. Please try again.",duration:2500})}})},[x,I]=i.useState(1),y=10,z=Math.ceil(p.length/y),L=p.slice((x-1)*y,x*y);function W(t){const o=Object.fromEntries(Object.entries(t).filter(([a,M])=>M!==""&&M!==void 0));B.get(route("admin.reports.index"),{...o,search:h||void 0})}function se(){f(""),B.get(route("admin.reports.index"))}function le(t){t.key==="Enter"&&W(g)}const ae=()=>{if(!p||p.length===0){alert("No reports available to print.");return}const t=window.open("","","width=900,height=700"),o=p.map(a=>`
        <tr>
            <td>${a.id}</td>
            <td>${a.room?.room_number??"N/A"}</td>
            <td>${a.user?.name??"N/A"}</td>
            <td>${a.reportable_type??"N/A"}</td>
            <td>${a.condition??"N/A"}</td>
            <td>${a.remarks??"N/A"}</td>
            <td>${a.created_at?new Date(a.created_at).toLocaleString():"N/A"}</td>
            <td>${a.resolved?"Resolved":"Pending"}</td>
        </tr>
    `).join("");t.document.write(`
        <html>
            <head>
                <title>Faculty Reports</title>
                <style>
                    body {
                        font-family: Arial, sans-serif;
                        padding: 20px;
                    }
                    h2 {
                        text-align: center;
                        margin-bottom: 20px;
                        color: #2e7d32;
                    }
                    p {
                        text-align: right;
                        font-size: 12px;
                        color: #666;
                    }
                    table {
                        width: 100%;
                        border-collapse: collapse;
                        margin-top: 10px;
                    }
                    th, td {
                        border: 1px solid #ccc;
                        padding: 8px;
                        text-align: left;
                        font-size: 13px;
                    }
                    th {
                        background-color: #2e7d32;
                        color: white;
                    }
                    tr:nth-child(even) {
                        background-color: #f9f9f9;
                    }
                    @media print {
                        body { -webkit-print-color-adjust: exact; }
                    }
                </style>
            </head>
            <body>
                <h2>Faculty Reports</h2>
                <p>Generated on: ${new Date().toLocaleString()}</p>

                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Room</th>
                            <th>Faculty</th>
                            <th>Report Type</th>
                            <th>Condition</th>
                            <th>Details</th>
                            <th>Date Created</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${o}
                    </tbody>
                </table>
            </body>
        </html>
    `),t.document.close(),t.print()},re={system_unit:["Working","Not Working","Intermittent Issue","Needs Cleaning","For Replacement","For Disposal","Condemned","Needs Repair","No Signal","Needs Configuration","Under Maintenance","To Be Diagnosed"],peripheral:["Working","Not Working","Intermittent Issue","Needs Cleaning","For Replacement","For Disposal","Condemned","Needs Repair","No Signal","Needs Configuration","Under Maintenance","To Be Diagnosed"],equipment:["Working","Not Working","Intermittent Issue","Needs Cleaning","For Replacement","For Disposal","Condemned","Minor Damage","Needs Repair","Intermittent Connectivity","No Signal","Needs Configuration","Expired","Needs Refill","Rusting","To Be Diagnosed"]};return e.jsxs(ie,{children:[e.jsx(Ne,{}),e.jsxs(ce,{children:[e.jsx("header",{className:"sticky top-0 z-20 bg-white border-b px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{}),e.jsx(pe,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(je,{children:e.jsx(be,{children:e.jsxs(ge,{children:[e.jsx(X,{href:"#","aria-current":"page",children:"Reports"}),e.jsx(fe,{}),e.jsx(X,{href:"/admin/faculty/reports","aria-current":"page",className:"font-semibold text-foreground",children:"Faculty Reports"})]})})}),e.jsx("div",{className:"flex-1"}),e.jsx(he,{})]})}),e.jsx("main",{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-5",children:"Faculty Reports"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[e.jsx(J,{placeholder:"Search reports...",value:h,onChange:t=>f(t.target.value),onKeyDown:le,className:`flex-1 min-w-0 sm:max-w-xs w-full
             border-[hsl(142,34%,51%)] text-[hsl(142,34%,20%)]
             focus:border-[hsl(142,34%,45%)] focus:ring-[hsl(142,34%,45%)]
             placeholder:text-[hsl(142,34%,40%)]`}),e.jsx(we,{filters:g,filterOptions:D,onApplyFilters:W,onResetFilters:se}),e.jsxs(b,{className:"flex items-center gap-2 bg-[hsl(183,40%,45%)] text-white border-none hover:bg-[hsl(183,40%,38%)]",onClick:ae,children:[e.jsx(Re,{className:"h-4 w-4"}),"Print"]})]}),e.jsx(oe,{children:e.jsxs(ne,{className:"p-0",children:[e.jsxs(me,{children:[e.jsx(xe,{children:e.jsxs(q,{className:"bg-[hsl(142,34%,85%)] text-[hsl(142,34%,25%)] hover:bg-[hsl(142,34%,80%)]",children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"Faculty"}),e.jsx(c,{children:"Room"}),e.jsx(c,{children:"Reports Type"}),e.jsx(c,{children:"Reports ID"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Code"}),e.jsx(c,{children:"Condition"}),e.jsx(c,{children:"Remarks"}),e.jsx(c,{children:"Photo"}),e.jsx(c,{children:"Date Reported"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ue,{children:L.length>0?L.map((t,o)=>e.jsxs(q,{children:[e.jsx(n,{children:(x-1)*y+o+1}),e.jsx(n,{children:t.user?.name||"N/A"}),e.jsxs(n,{children:["ROOM"," ",t.room?t.room.room_number:"N/A"]}),e.jsx(n,{children:t.reportable_type}),e.jsx(n,{children:t.reportable_id}),e.jsx(n,{children:t.reportable_type==="peripheral"?t.reportable?.type:t.reportable_type==="system_unit"?"System Unit":t.reportable_type==="equipment"&&(t.reportable?.type||t.reportable?.equipment_type)||"N/A"}),e.jsx(n,{children:t.reportable_type==="peripheral"?t.reportable?.peripheral_code:t.reportable_type==="system_unit"?t.reportable?.unit_code:t.reportable_type==="equipment"?t.reportable?.equipment_code:"N/A"}),e.jsx(n,{children:t.condition}),e.jsx(n,{children:t.remarks}),e.jsx(n,{children:t.photo_url?e.jsx("img",{src:t.photo_url,alt:"Report",className:"w-16 h-16 object-cover rounded cursor-pointer hover:shadow-lg",onClick:()=>s(t.photo_url)}):"No photo"}),e.jsx(n,{children:new Date(t.created_at).toLocaleDateString()}),e.jsx(n,{children:e.jsx("div",{className:"flex gap-2",children:t.resolved?e.jsxs("span",{className:"text-sm font-medium text-green-600 flex items-center gap-1",children:[e.jsx(Q,{className:"w-4 h-4"}),"Resolved"]}):e.jsxs(b,{size:"sm",variant:"secondary",className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",onClick:()=>ee(t),children:[e.jsx(Q,{className:"w-4 h-4"}),"Resolve"]})})})]},t.id)):e.jsx(q,{children:e.jsx(n,{colSpan:"11",className:"text-center",children:"No reports found."})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mt-4 p-2 gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing"," ",p.length===0?0:(x-1)*y+1," ","â€“",Math.min(x*y,p.length)," ","of ",p.length," reports"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(b,{variant:"outline",size:"sm",disabled:x===1,onClick:()=>I(x-1),children:"Previous"}),[...Array(z)].map((t,o)=>e.jsx(b,{variant:x===o+1?"default":"outline",size:"sm",onClick:()=>I(o+1),children:o+1},o)),e.jsx(b,{variant:"outline",size:"sm",disabled:x===z,onClick:()=>I(x+1),children:"Next"})]})]})]})})]})}),e.jsx(U,{open:_,onOpenChange:k,children:e.jsxs(H,{className:"flex flex-col items-center",children:[e.jsx(G,{children:e.jsx(K,{children:"Report Photo"})}),d&&e.jsx("img",{src:d,alt:"Report",className:"max-w-full max-h-[80vh] object-contain rounded"})]})}),e.jsx(U,{open:m,onOpenChange:N,children:e.jsxs(H,{className:"max-w-md w-full rounded-2xl border border-[hsl(142,34%,85%)] shadow-xl bg-white/90 backdrop-blur-lg",children:[e.jsxs(G,{className:"pb-2",children:[e.jsxs(K,{className:"text-[hsl(142,34%,25%)] text-xl font-semibold",children:["Resolve Report #",l?.id]}),e.jsxs("div",{className:"text-sm text-[hsl(142,34%,30%)] mt-1 flex flex-col gap-0.5",children:[e.jsxs("span",{children:[l?.reportable_type==="system_unit"&&e.jsxs(e.Fragment,{children:["Unit Code:"," ",e.jsx("span",{className:"font-medium text-[hsl(142,34%,45%)]",children:l?.reportable?.unit_code||"N/A"})]}),l?.reportable_type==="equipment"&&e.jsxs(e.Fragment,{children:["Equipment Code:"," ",e.jsx("span",{className:"font-medium text-[hsl(142,34%,45%)]",children:l?.reportable?.equipment_code||"N/A"})]}),l?.reportable_type==="peripheral"&&e.jsxs(e.Fragment,{children:["Peripheral Code:"," ",e.jsx("span",{className:"font-medium text-[hsl(142,34%,45%)]",children:l?.reportable?.peripheral_code||"N/A"})]})]}),e.jsxs("span",{children:["Type:"," ",e.jsx("span",{className:"font-medium text-[hsl(142,34%,45%)]",children:l?.reportable_type==="system_unit"?"System Unit":l?.reportable_type==="equipment"?l?.reportable?.equipment_type||"Equipment":l?.reportable_type==="peripheral"?l?.reportable?.type||"Peripheral":"N/A"})]}),l?.room&&e.jsxs("span",{children:["Room:"," ",e.jsx("span",{className:"font-medium text-[hsl(142,34%,45%)]",children:l.room.room_number})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-5 mt-3",children:[l?.remarks&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx($,{className:"text-gray-700 font-medium",children:"Remarks"}),e.jsx("div",{className:"border border-[hsl(142,34%,80%)] rounded-lg p-3 text-sm bg-[hsl(142,34%,96%)]",children:l.remarks})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx($,{className:"text-gray-700 font-medium",children:"Set Condition"}),e.jsxs(C,{value:F||l?.condition,onValueChange:P,children:[e.jsx(R,{className:"rounded-lg border-[hsl(142,34%,75%)] focus:ring-[hsl(142,34%,45%)]",children:e.jsx(S,{placeholder:"Select Condition"})}),e.jsx(w,{children:(()=>{const t=l?.reportable_type;return(re[t]||[]).map(a=>e.jsx(u,{value:a,className:"cursor-pointer",children:a},a))})()})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx($,{className:"text-gray-700 font-medium",children:"Resolution Details"}),e.jsx(J,{type:"text",placeholder:"Describe how you fixed it...",value:E,onChange:t=>A(t.target.value),className:"rounded-lg border-[hsl(142,34%,75%)] focus:ring-[hsl(142,34%,45%)]"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(b,{variant:"outline",onClick:()=>N(!1),disabled:T,className:"rounded-lg border-[hsl(142,34%,60%)] text-[hsl(142,34%,30%)] hover:bg-[hsl(142,34%,90%)]",children:"Cancel"}),e.jsx(b,{onClick:()=>te(l),disabled:T,className:"rounded-lg bg-[hsl(142,34%,45%)] text-white hover:bg-[hsl(142,34%,40%)]",children:T?"Saving...":"Save"})]})]})]})})]})]})}export{dt as default};
