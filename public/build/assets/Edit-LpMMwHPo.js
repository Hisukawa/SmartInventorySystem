import{r as c,u as F,j as e,T as D,H as P,a as C,t as l,c as R}from"./app-CO_XefRP.js";import{A as k}from"./AuthenticatedLayout-BM15DCYK.js";import A from"./UpdatePasswordForm-D2KkrZLy.js";import S from"./UpdateProfileInformationForm-D8rl4ioM.js";import{B as d}from"./button-Caqt5Asn.js";import{D as $,a as E,b as T,c as I,d as U,e as O}from"./dialog-BaMOWnKH.js";import"./transition-DmLUiHb7.js";import"./TextInput-CAY51nX_.js";import"./InputLabel-YTI2aOUD.js";import"./PrimaryButton-4HVWgSZ2.js";import"./index-vUOHopH7.js";import"./utils-CBfrqCZ4.js";import"./index-C38S9Elj.js";import"./createLucideIcon-BSW1fS9S.js";import"./index-DYMvDSyA.js";import"./index-DZCEG574.js";function se({user:o,mustVerifyEmail:f,status:h}){const[p,u]=c.useState(o?.photo?`/storage/${o.photo}`:"/default-avatar.png"),[b,n]=c.useState(!1),[H,_]=c.useState(!1),g=c.useRef(null),i=F({photo:null}),[t,j]=c.useState(o?.face_recognition_enabled||!1),[s,x]=c.useState(0);c.useEffect(()=>{let a;return s>0&&(a=setTimeout(()=>x(s-1),1e3)),()=>clearTimeout(a)},[s]);const v=a=>{const r=a.target.files[0];if(!r)return;i.setData("photo",r);const m=new FileReader;m.onloadend=()=>u(m.result),m.readAsDataURL(r)},w=a=>{a.preventDefault(),i.patch(route("profile.update"),{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{i.reset("photo"),n(!1),l.success("Profile photo updated!")},onError:()=>l.error("Failed to update photo.")})},N=a=>a.charAt(0).toUpperCase()+a.slice(1),y=async()=>{if(s>0){l.error(`Please wait ${s} seconds before toggling again.`);return}const a=t?route("face.deactivate"):route("face.reactivate");try{const{data:r}=await R.post(a);l.success(r.message||(t?"Face recognition disabled!":"Face recognition enabled!")),j(!t),x(20)}catch(r){l.error(r.response?.data?.message||"Action failed.")}};return e.jsxs(k,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:o?.role?`${N(o.role)} Profile`:"Profile"}),children:[e.jsx(D,{position:"top-right"}),e.jsx(P,{title:"Profile"}),e.jsxs("div",{className:"py-12 space-y-6",children:[e.jsxs("div",{className:"max-w-lg mx-auto p-6 bg-white shadow-lg rounded-lg flex flex-col items-center space-y-4",children:[e.jsx("img",{src:p,alt:o?.name,className:"w-32 h-32 rounded-full object-cover border"}),e.jsx("h1",{className:"text-xl font-bold",children:o?.name}),e.jsx("p",{className:"text-sm text-gray-500",children:o?.email}),e.jsx("div",{className:"w-full mt-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-center sm:items-start gap-3",children:[e.jsxs("button",{onClick:()=>C.visit(route("face.register.page")),title:"Register / Activate Face Recognition","aria-label":"Register face recognition",className:"flex items-center gap-3 w-full sm:w-auto justify-center px-4 py-3 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx("img",{src:"/icons/register-face.png",alt:"Register Face",className:"w-10 h-10 sm:w-8 sm:h-8"}),e.jsx("span",{className:"block sm:hidden text-sm text-blue-700 font-medium",children:"Register Face"}),e.jsx("span",{className:"hidden sm:block text-xs text-blue-800 mt-0.5",children:"Register"})]}),e.jsxs("button",{onClick:y,title:t?"Face recognition is active — click to disable":"Face recognition is inactive — click to enable","aria-pressed":t,"aria-label":t?"Disable face recognition":"Enable face recognition",disabled:s>0,className:`flex items-center gap-3 w-full sm:w-auto justify-center px-4 py-3 rounded-lg transition-colors ${t?"bg-green-50 hover:bg-green-100":"bg-red-50 hover:bg-red-100"} ${s>0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("img",{src:t?"/icons/active-face.png":"/icons/inactive-face.png",alt:t?"Active Face":"Inactive Face",className:"w-10 h-10 sm:w-8 sm:h-8"}),e.jsx("span",{className:"block sm:hidden text-sm font-medium",children:t?"Active":"Inactive"}),e.jsx("span",{className:"hidden sm:block text-xs mt-0.5",children:t?`Active${s>0?` (${s}s)`:""}`:`Inactive${s>0?` (${s}s)`:""}`})]})]})})]}),e.jsx("div",{className:"bg-white p-4 shadow sm:rounded-lg sm:p-8 max-w-xl mx-auto",children:e.jsx(S,{mustVerifyEmail:f,status:h})}),e.jsx("div",{className:"bg-white p-4 shadow sm:rounded-lg sm:p-8 max-w-xl mx-auto",children:e.jsx(A,{})}),e.jsx($,{open:b,onOpenChange:n,children:e.jsxs(E,{className:"sm:max-w-md",children:[e.jsxs(T,{children:[e.jsx(I,{children:"Update Profile Photo"}),e.jsxs(U,{children:["Choose a new profile photo for ",o?.name,"."]})]}),e.jsxs("form",{onSubmit:w,className:"flex flex-col items-center gap-4 mt-2",encType:"multipart/form-data",children:[e.jsx("img",{src:p,alt:"Preview",className:"w-32 h-32 rounded-full object-cover border"}),e.jsx("input",{type:"file",accept:"image/*",ref:g,onChange:v,className:"hidden"}),e.jsx(d,{type:"button",variant:"secondary",onClick:()=>g.current.click(),children:"Choose Photo"}),i.data.photo&&e.jsx("span",{className:"text-sm text-gray-600",children:i.data.photo.name}),e.jsxs(O,{className:"mt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(d,{type:"submit",disabled:i.processing,children:i.processing?"Saving...":"Save"})]})]})]})})]})]})}export{se as default};
