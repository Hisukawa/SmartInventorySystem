import{r as d,j as e,a as V,R as ae}from"./app-3vLMqhnz.js";import{B as i}from"./button-wZybxZUW.js";import{A as oe}from"./app-sidebar-vtRggODQ.js";import{S as re,a as ce,b as de,c as me}from"./avatar-C8cC5PNR.js";import{I as xe}from"./input-B89NL6q8.js";import{N as he}from"./Notification-Css2OKjH.js";import pe from"./EditEquipmentPage-C5cr8et6.js";import{Q as ue}from"./index-BU1u_fir.js";import{S as ge,J as je,R as be,F as fe}from"./server.browser-CC5omqj0.js";import{C as Q}from"./checkbox-D7CJcJS-.js";import{T as Ne,a as ye,b as D,c as y,d as we,e as u}from"./table-CigXlLP5.js";import{B as ve,a as Ce,b as Se,c as H,d as Re}from"./breadcrumb-iL8OPzII.js";import{P as Ee,a as ke,b as _e}from"./popover-7bU8L_23.js";import{S as q,a as P,b as A,c as T,d as m}from"./select--ad95f2R.js";import{P as qe}from"./printer-DbvYv9ZB.js";import{E as U}from"./eye-CyrIoDJM.js";import{P as W}from"./pen-zPdEaDAL.js";import{l as _,E as Pe}from"./menu-Bvf_eQS9.js";import{F as Ae}from"./funnel-8_BO4L4q.js";import"./index-CfpO-yTh.js";import"./utils-CBfrqCZ4.js";import"./dropdown-menu-DHX_ivd9.js";import"./index-DvTIV6Gf.js";import"./index-a14Y7yQe.js";import"./index-Cezy_WIn.js";import"./createLucideIcon-C80kBUb2.js";import"./chevron-right-Dvw-UYj9.js";import"./house-CDK9ky9w.js";import"./user-Cdut0ewx.js";import"./log-out-CN7z4qzL.js";import"./keyboard-DpVXvdt6.js";import"./boxes-BWmRsK1C.js";import"./users-3H6CDmrF.js";import"./chevron-down-Beg7KCp0.js";import"./index-Ct6C1Q_B.js";import"./index-58HsG08c.js";import"./index-CWMewDmF.js";import"./bell-DOVSIm9q.js";import"./dialog-DxTsVUa2.js";import"./index-3PW5GnMA.js";import"./portal-DRnHwN1c.js";import"./open-closed-O_30hLlc.js";import"./with-selector-BYrok-yl.js";const Te={Working:"bg-green-200 text-green-800","Not Working":"bg-red-200 text-red-800","Intermittent Issue":"bg-yellow-200 text-yellow-800","Needs Cleaning":"bg-blue-200 text-blue-800","For Replacement":"bg-orange-200 text-orange-800","For Disposal":"bg-gray-200 text-gray-800",Condemned:"bg-black text-white","Minor Damage":"bg-yellow-200 text-yellow-800","Needs Repair":"bg-red-200 text-red-800","Intermittent Connectivity":"bg-yellow-200 text-yellow-800","No Signal":"bg-red-200 text-red-800","Needs Configuration":"bg-blue-200 text-blue-800",Expired:"bg-red-300 text-red-900","Needs Refill":"bg-blue-200 text-blue-900",Rusting:"bg-orange-200 text-orange-900","To Be Diagnosed":"bg-blue-100 text-blue-700"};function $e({filters:a,filterOptions:h,onApplyFilters:S}){const[r,g]=d.useState(""),[c,R]=d.useState(""),j=n=>{const x=n==="all"?"":n;R(x),r==="type"?S({...a,type:x}):r==="condition"?S({...a,condition:x}):r==="room"&&S({...a,room_id:x})},w=()=>{g(""),R(""),S({type:"",condition:"",room_id:""})};return e.jsxs(Ee,{children:[e.jsx(ke,{asChild:!0,children:e.jsxs(i,{className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",children:[e.jsx(Ae,{className:"h-4 w-4"})," ","Filters"]})}),e.jsx(_e,{className:"w-72",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(q,{value:r,onValueChange:n=>{g(n),R("")},children:[e.jsx(P,{children:e.jsx(A,{placeholder:"Select filter field"})}),e.jsxs(T,{children:[e.jsx(m,{value:"type",children:"Type"}),e.jsx(m,{value:"condition",children:"Condition"}),e.jsx(m,{value:"room",children:"Room"})]})]}),r==="type"&&e.jsxs(q,{value:c||"all",onValueChange:j,children:[e.jsx(P,{children:e.jsx(A,{placeholder:"Select Type"})}),e.jsxs(T,{children:[e.jsx(m,{value:"all",children:"All"}),h.types.map(n=>e.jsx(m,{value:n,children:n},n))]})]}),r==="condition"&&e.jsxs(q,{value:c||"all",onValueChange:j,children:[e.jsx(P,{children:e.jsx(A,{placeholder:"Select Condition"})}),e.jsxs(T,{children:[e.jsx(m,{value:"all",children:"All"}),h.conditions.map(n=>e.jsx(m,{value:n,children:n},n))]})]}),r==="room"&&e.jsxs(q,{value:c||"all",onValueChange:j,children:[e.jsx(P,{children:e.jsx(A,{placeholder:"Select Room"})}),e.jsxs(T,{children:[e.jsx(m,{value:"all",children:"All"}),Object.entries(h.rooms).map(([n,x])=>e.jsxs(m,{value:n,children:["Room ",x]},n))]})]}),(r||c)&&e.jsx("div",{className:"flex justify-end",children:e.jsx(i,{size:"sm",variant:"outline",onClick:w,className:"flex items-center gap-1 text-red-600 hover:bg-red-50",children:"Reset"})})]})})]})}function Rt({equipments:a,existingRooms:h,filters:S={}}){const[r,g]=d.useState(!1),[c,R]=d.useState(null),[j,w]=d.useState([]),[n,x]=d.useState(!1),J=t=>{R(t),w([]),x(!1)},G=()=>{if(n)w([]);else if(c){const t=a.filter(s=>s.room_id===c).map(s=>s.id);w(t)}x(!n)},Z=t=>{w(s=>s.includes(t)?s.filter(l=>l!==t):[...s,t])},K=async()=>{if(j.length===0){alert("Select at least one equipment.");return}const t=a.filter(l=>j.includes(l.id)),s=new je;for(const l of t){const k=`${window.location.origin}/equipment/${l.equipment_code}`,B=be.renderToString(e.jsx(ue,{value:k,size:256})),le=new Blob([B],{type:"image/svg+xml"}),M=URL.createObjectURL(le),C=new Image;await new Promise(ne=>{C.onload=()=>{const f=document.createElement("canvas");f.width=C.width+40,f.height=C.height+40+50;const N=f.getContext("2d");N.fillStyle="#fff",N.fillRect(0,0,f.width,f.height),N.drawImage(C,20,20),N.fillStyle="#000",N.font="bold 18px Arial",N.textAlign="center",N.fillText(`Room ${l.room?.room_number} - ${l.equipment_code}`,f.width/2,C.height+20+30),f.toBlob(ie=>{s.file(`${l.equipment_code}.png`,ie),ne()},"image/png")},C.src=M}),URL.revokeObjectURL(M)}s.generateAsync({type:"blob"}).then(l=>{fe.saveAs(l,"Equipment_QR_Codes.zip")})},[$,X]=d.useState(""),[o,E]=d.useState(1),[b,F]=d.useState({}),v=10,Y=d.useMemo(()=>{const t=s=>[...new Set(s.filter(Boolean))].sort();return{types:t(a.map(s=>s.type)),conditions:t(a.map(s=>s.condition)),rooms:Object.fromEntries(h.map(s=>[String(s.id),s.room_number]))}},[a,h]),[L,I]=d.useState({open:!1,equipmentCode:null}),p=a.filter(t=>{const s=t.equipment_code.toLowerCase().includes($.toLowerCase())||t.equipment_name.toLowerCase().includes($.toLowerCase()),l=!b.type||t.type===b.type,k=!b.condition||t.condition===b.condition,B=!b.room||t.room?.id===parseInt(b.room);return s&&l&&k&&B}),z=Math.ceil(p.length/v)||1,O=p.slice((o-1)*v,o*v),ee=()=>{if(!p||p.length===0){alert("No data available to print.");return}const t=window.open("","","width=900,height=700"),s=p.map((l,k)=>`
            <tr>
                <td>${k+1}</td>
                <td>${l.equipment_code}</td>
                <td>${l.equipment_name}</td>
                <td>${l.room?.room_number??"N/A"}</td>
                <td>${l.type}</td>
                <td>${l.condition??"N/A"}</td>
            </tr>
        `).join("");t.document.write(`
            <html>
                <head>
                    <title>Equipment Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h2 { text-align: center; margin-bottom: 20px; color: #2e7d32; }
                        p { text-align: right; font-size: 12px; color: #666; }
                        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; font-size: 13px; }
                        th { background-color: #2e7d32; color: white; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        @media print { body { -webkit-print-color-adjust: exact; } }
                    </style>
                </head>
                <body>
                    <h2>Equipment Report</h2>
                    <p>Generated on: ${new Date().toLocaleString()}</p>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Equipment Code</th>
                                <th>Equipment Name</th>
                                <th>Room</th>
                                <th>Type</th>
                                <th>Condition</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${s}
                        </tbody>
                    </table>
                </body>
            </html>
        `),t.document.close(),t.print()},te=t=>{F(t),E(1)},se=()=>{F({}),E(1)};return e.jsxs(re,{children:[e.jsx(oe,{}),L.open&&e.jsx(pe,{equipment:a.find(t=>t.equipment_code===L.equipmentCode),rooms:h,onClose:()=>I({open:!1,equipmentCode:null})}),e.jsxs(ce,{children:[e.jsxs("header",{className:"sticky top-0 z-20 bg-white border-b px-6 py-3 flex items-center gap-2",children:[e.jsx(de,{}),e.jsx(me,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(ve,{children:e.jsx(Ce,{children:e.jsxs(Se,{children:[e.jsx(H,{href:"#",children:"Assets"}),e.jsx(Re,{}),e.jsx(H,{href:"/equipments",className:"font-semibold text-foreground",children:"Equipments"})]})})}),e.jsx("div",{className:"flex-1"}),e.jsx(he,{})]}),e.jsxs("main",{className:"w-full px-6 py-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-5",children:"Equipments"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch sm:items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex gap-2 items-center flex-1",children:[e.jsx(xe,{placeholder:"Search Equipment...",value:$,onChange:t=>X(t.target.value),className:"flex-1 min-w-0 sm:max-w-xs w-full border-[hsl(142,34%,51%)]"}),e.jsx($e,{filters:b,filterOptions:Y,onApplyFilters:te,onReset:se}),e.jsxs(i,{onClick:ee,className:"flex items-center gap-2 bg-[hsl(183,40%,45%)] text-white border-none hover:bg-[hsl(183,40%,38%)]",children:[e.jsx(qe,{className:"h-4 w-4"}),"Print"]}),e.jsx(i,{className:"bg-[hsl(142,34%,51%)] text-white hover:bg-[hsl(142,34%,45%)]",onClick:()=>g(!0),children:"Download QR Codes"})]}),e.jsx(i,{className:"bg-[hsl(142,31%,51%)] hover:bg-[hsl(142,31%,45%)] text-white",onClick:()=>V.visit("/equipments/addequipment"),children:"Add Equipment"})]}),e.jsxs("div",{className:"overflow-x-auto rounded-lg border",children:[e.jsxs(Ne,{className:"w-full table-auto text-center",children:[e.jsx(ye,{children:e.jsxs(D,{className:"bg-[hsl(142,34%,85%)] text-[hsl(142,34%,25%)] hover:bg-[hsl(142,34%,80%)]",children:[e.jsx(y,{className:"px-5 py-1 text-center",children:"#"}),e.jsx(y,{className:"px-5 py-1 text-center",children:"Equipment Code"}),e.jsx(y,{className:"px-5 py-1 text-center",children:"Equipment Name"}),e.jsx(y,{className:"px-5 py-1 text-center",children:"Room"}),e.jsx(y,{className:"px-5 py-1 text-center",children:"Type"}),e.jsx(y,{className:"px-5 py-1 text-center",children:"Condition"}),e.jsx(y,{className:"px-5 py-1 text-center",children:"Actions"})]})}),e.jsx(we,{children:O.length>0?O.map((t,s)=>e.jsxs(D,{className:"hover:shadow-sm",children:[e.jsx(u,{className:"px-5 py-2 align-middle",children:(o-1)*v+s+1}),e.jsx(u,{className:"px-5 py-2 align-middle",children:t.equipment_code}),e.jsx(u,{className:"px-5 py-2 align-middle",children:t.equipment_name}),e.jsx(u,{className:"px-5 py-2 align-middle",children:t.room?.room_number??"N/A"}),e.jsx(u,{className:"px-5 py-2 align-middle",children:t.type}),e.jsx(u,{className:"px-5 py-2 align-middle",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Te[t.condition]||"bg-gray-200 text-gray-800"}`,children:t.condition})}),e.jsxs(u,{className:"px-5 py-2 align-middle",children:[e.jsxs("div",{className:"hidden sm:flex justify-center items-center gap-2",children:[e.jsxs(i,{size:"sm",className:"bg-[hsl(142,34%,51%)] text-white flex items-center gap-2",onClick:()=>V.visit(`/admin/equipments/${t.equipment_code}`),children:[e.jsx(U,{className:"h-4 w-4"})," ","View"]}),e.jsxs(i,{size:"sm",className:"bg-[hsl(142,34%,51%)] text-white flex items-center gap-2",onClick:()=>I({open:!0,equipmentCode:t.equipment_code}),children:[e.jsx(W,{className:"h-4 w-4"})," ","Edit"]})]}),e.jsx("div",{className:"sm:hidden flex justify-center",children:e.jsxs(_,{as:"div",className:"relative inline-block text-left",children:[e.jsx(_.Button,{className:"p-2 rounded bg-[hsl(142,34%,51%)] text-white",children:e.jsx(Pe,{className:"h-5 w-5"})}),e.jsx(_.Items,{className:"absolute right-0 mt-2 w-28 origin-top-right bg-white border border-gray-200 divide-y divide-gray-100 rounded-md shadow-lg focus:outline-none z-50",children:e.jsxs("div",{className:"px-1 py-1",children:[e.jsx(_.Item,{children:({active:l})=>e.jsxs("button",{className:`${l?"bg-[hsl(142,34%,90%)]":""} group flex w-full items-center rounded-md px-2 py-2 text-sm text-gray-700`,onClick:()=>V.visit(`/admin/equipments/${t.equipment_code}`),children:[e.jsx(U,{className:"h-4 w-4 mr-2"})," ","View"]})}),e.jsx(_.Item,{children:({active:l})=>e.jsxs("button",{className:`${l?"bg-[hsl(142,34%,90%)]":""} group flex w-full items-center rounded-md px-2 py-2 text-sm text-gray-700`,onClick:()=>I({open:!0,equipmentCode:t.equipment_code}),children:[e.jsx(W,{className:"h-4 w-4 mr-2"})," ","Edit"]})})]})})]})})]})]},t.id)):e.jsx(D,{children:e.jsx(u,{colSpan:7,className:"text-center py-4",children:"No equipments found."})})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing"," ",p.length===0?0:(o-1)*v+1," ","–"," ",Math.min(o*v,p.length)," ","of ",p.length," equipments"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",disabled:o===1,onClick:()=>E(o-1),children:"Previous"}),Array.from({length:z},(t,s)=>s+1).filter(t=>t===1||t===z?!0:t>=o-2&&t<=o+2).map((t,s,l)=>e.jsxs(ae.Fragment,{children:[s>0&&l[s]-l[s-1]>1&&e.jsx("span",{className:"px-2",children:"..."}),e.jsx(i,{size:"sm",variant:o===t?"default":"outline",onClick:()=>E(t),children:t})]},t)),e.jsx(i,{size:"sm",variant:"outline",disabled:o===z,onClick:()=>E(o+1),children:"Next"})]})]})]}),e.jsxs("div",{className:`fixed top-0 right-0 h-full w-96 bg-white shadow-xl transform transition-transform duration-300 z-50 flex flex-col
${r?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Download Equipment QR Codes by Room"}),e.jsx(i,{variant:"ghost",onClick:()=>g(!1),children:"✕"})]}),e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("label",{className:"block mb-2 font-medium text-sm text-gray-700",children:"Select Room"}),e.jsxs(q,{value:c||"",onValueChange:t=>J(Number(t)),children:[e.jsx(P,{className:"w-full",children:e.jsx(A,{placeholder:"-- Select Room --"})}),e.jsx(T,{children:h.map(t=>e.jsx(m,{value:t.id.toString(),children:t.room_number},t.id))})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b",children:[e.jsx(Q,{checked:n,onCheckedChange:G}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Select All Equipments in Room"})]}),c&&e.jsx(ge,{className:"flex-1 overflow-y-auto p-4 space-y-2",children:a.filter(t=>t.room_id===c).map(t=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-md hover:bg-gray-50 transition",children:[e.jsx(Q,{checked:j.includes(t.id),onCheckedChange:()=>Z(t.id)}),e.jsx("span",{className:"text-sm text-gray-800",children:t.equipment_code})]},t.id))}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx(i,{variant:"secondary",onClick:()=>g(!1),children:"Close"}),e.jsx(i,{className:"bg-[hsl(142,34%,51%)] text-white hover:bg-[hsl(142,34%,45%)]",onClick:K,children:"Download Selected"})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:()=>g(!1)})]})]})]})}export{Rt as default};
