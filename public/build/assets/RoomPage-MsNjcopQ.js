import{r,u as y,j as e,b as x}from"./app-CBWTJU5K.js";import{Q as T}from"./index-D1Z06ILU.js";import{S as j}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{T as W,a as Z,b as _,c,d as ee,e as d}from"./table-Cu6Nqw6B.js";import{B as i}from"./button-BL3iV3E7.js";import{I as B}from"./input-BsoqWy2r.js";import{D,a as z,b as se,c as E}from"./dialog-CUBB70fc.js";import{A as te}from"./app-sidebar-Cilzw0Nb.js";import{B as re,a as ae,b as oe,c as ne}from"./breadcrumb-CDtehEh_.js";import{S as ie,a as le,b as ce,c as de}from"./index-BOztI01U.js";import"./index-DZE4h3iZ.js";import"./index-DH4sAsUT.js";import"./index-BGWZyKil.js";import"./index-B4Ev5MoV.js";import"./chevron-right-BejQxAIm.js";import"./dropdown-menu-C4Baw4pv.js";import"./index-Ckcdz0TT.js";import"./index-DUs_jQhL.js";function Oe({rooms:l,search:k}){const[b,M]=r.useState(k||""),[me,xe]=r.useState(!1),[O,m]=r.useState(!1),[q,I]=r.useState(null),[u,w]=r.useState(""),[p,S]=r.useState(""),[Q,v]=r.useState(!1),[R,ue]=r.useState("");y({room_number:""});const{data:L,setData:C,put:A,processing:H,errors:N,reset:P}=y({room_number:""}),$=s=>{s.preventDefault(),A(`/admin/rooms/${q.id}`,{preserveScroll:!0,onSuccess:()=>{m(!1),P(),j.fire({icon:"success",title:"Room updated!",showConfirmButton:!1,timer:1500})}})},U=s=>{I(s),C("room_number",s.room_number),m(!0)},F=s=>{s.key==="Enter"&&x.get("/admin/rooms",{search:b})},K=(s,t)=>{s&&(w(s),S(t))},X=()=>{const s=document.getElementById("qr-download"),a=new XMLSerializer().serializeToString(s),h=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),J=URL.createObjectURL(h),g=new Image;g.onload=()=>{const o=document.createElement("canvas"),n=o.getContext("2d");o.width=220,o.height=260,n.fillStyle="#fff",n.fillRect(0,0,o.width,o.height),n.drawImage(g,10,10,200,200),n.fillStyle="#000",n.font="bold 16px sans-serif",n.textAlign="center",n.fillText(`ROOM ${p}`,o.width/2,235);const V=o.toDataURL("image/png"),f=document.createElement("a");f.href=V,f.download=`room-${p}-qr.png`,f.click()},g.src=J},Y=async()=>{await navigator.clipboard.writeText(u),v(!0),setTimeout(()=>v(!1),2e3)},G=s=>{j.fire({title:"Are you sure?",text:"This room will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"}).then(t=>{t.isConfirmed&&x.delete(`/admin/rooms/${s}`,{preserveScroll:!0,onSuccess:()=>{j.fire({icon:"success",title:"Deleted!",text:"The room has been deleted.",timer:1500,showConfirmButton:!1})}})})};return e.jsxs(ie,{children:[e.jsx(te,{}),e.jsxs(le,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 border-b bg-white",children:[e.jsx(ce,{}),e.jsx(de,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(re,{children:e.jsx(ae,{children:e.jsx(oe,{children:e.jsx(ne,{href:"/admin/rooms","aria-current":"page",className:"font-semibold text-foreground",children:"Room Lists"})})})})]}),e.jsxs("main",{className:"w-full px-6 py-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h1",{className:"text-xl font-bold",children:"Room Management"})}),R&&e.jsx("div",{className:"mb-4 p-3 bg-green-100 text-green-800 rounded shadow text-sm",children:R}),e.jsx(D,{open:O,onOpenChange:m,children:e.jsxs(z,{children:[e.jsx(se,{children:e.jsx(E,{children:"Edit Room"})}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsx(B,{placeholder:"e.g. 101",value:L.room_number,onChange:s=>C("room_number",s.target.value)}),N.room_number&&e.jsx("p",{className:"text-sm text-red-500",children:N.room_number}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:H,children:"Update"})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(B,{placeholder:"Search rooms...",value:b,onChange:s=>M(s.target.value),onKeyDown:F,className:"mb-4 w-full sm:w-1/3"}),e.jsx(i,{onClick:()=>x.visit("/admin/rooms/create"),children:"Add Room"})]}),e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(W,{children:[e.jsx(Z,{children:e.jsxs(_,{children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"Room Name"}),e.jsx(c,{children:"Room Code"}),e.jsx(c,{children:"QR Code"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ee,{children:l.data.map((s,t)=>{const a=typeof s.room_path=="string"?`${window.location.origin}/room/${s.room_path}`:null;return e.jsxs(_,{children:[e.jsx(d,{children:(l.current_page-1)*l.per_page+t+1}),e.jsxs(d,{children:["ROOM ",s.room_number]}),e.jsx(d,{children:s.room_path}),e.jsx(d,{children:a?e.jsx("div",{className:"w-16 h-16 bg-white p-1 rounded cursor-pointer m-1",onClick:h=>{h.stopPropagation(),K(a,s.room_number)},children:e.jsx(T,{value:a,size:64})}):e.jsx("span",{className:"text-sm text-gray-500",children:"No QR"})}),e.jsxs(d,{children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>U(s),className:"mr-2",children:"Edit"}),e.jsx(i,{variant:"destructive",size:"sm",onClick:()=>G(s.id),children:"Delete"})]})]},s.id)})})]}),e.jsxs("div",{className:"mt-2 flex flex-col sm:flex-row justify-between items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground m-2",children:["Page ",l.current_page," of ",l.last_page]}),e.jsx("div",{className:"flex flex-wrap justify-center items-center gap-2",children:l.links.map((s,t)=>{const a=s.label.replace("&laquo;","«").replace("&raquo;","»");return e.jsx(i,{variant:s.active?"default":"ghost",size:"sm",className:"min-w-[36px] px-3 py-1",onClick:()=>s.url&&x.visit(s.url),disabled:!s.url,dangerouslySetInnerHTML:{__html:a}},t)})})]})]}),e.jsx(D,{open:!!u,onOpenChange:()=>{w(""),S("")},children:e.jsxs(z,{className:"max-w-sm text-center",children:[e.jsxs(E,{children:["ROOM ",p]}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"inline-block p-4 bg-white rounded cursor-pointer",onClick:s=>{s.stopPropagation(),Y()},children:[e.jsx(T,{id:"qr-download",value:u,size:200}),e.jsx("p",{className:"text-xs mt-2 text-muted-foreground",children:"Click QR to copy link"})]}),Q&&e.jsx("p",{className:"text-green-600 text-sm text-center mt-1",children:"Copied to clipboard!"}),e.jsx(i,{className:"mt-4",onClick:X,children:"Download QR"})]})]})})]})]})]})}export{Oe as default};
