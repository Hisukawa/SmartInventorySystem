import{r,j as e,a as B}from"./app-C8AU55Ti.js";import{B as u}from"./button-Bf0m1E31.js";import{C as te,a as re}from"./card-DXQAPcB5.js";import{S as oe,a as ne,b as ie,c as ce}from"./avatar-c9Tt2nUt.js";import{S as O}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{N as de}from"./Notification-sxYMHaPT.js";import{L as I}from"./label-CqZIc2TK.js";import{D as $,a as K,b as X,c as G}from"./dialog-D5L8rQg5.js";import{T as he,a as me,b as E,c as n,d as xe,e as t}from"./table-YohDIo_G.js";import{B as pe,a as ue,b as je,c as J,d as be}from"./breadcrumb-CU2xmbJ0.js";import{A as ve}from"./app-sidebar-B6toVx9n.js";import{I as Q}from"./input-fkttcr5C.js";import{P as fe,a as ge,b as ye}from"./popover-D10FheO5.js";import{S as f,a as g,b as y,c as N,d as o}from"./select-CY2HbR1f.js";import{C as W}from"./circle-check-VbClGG0H.js";import{F as Ne}from"./funnel-DVXDOhkU.js";import{X as Y}from"./index-DQDhcZEc.js";import"./index-DBhhzdAn.js";import"./utils-CBfrqCZ4.js";import"./createLucideIcon-BIDEulHG.js";import"./index-CquMoNXh.js";import"./index-DYBrNg48.js";import"./dropdown-menu-B-9leS4y.js";import"./index-0uhVE6pe.js";import"./chevron-right-CV6NnU3w.js";import"./index-CEtsD02S.js";import"./index-Dce7ijDe.js";import"./bell-DJ4_M3G9.js";import"./sparkles-BrzwCdNw.js";import"./keyboard-BAF7eCXJ.js";import"./boxes-DLlRq-uf.js";import"./users-CB3XdP7h.js";import"./user-C9yBI8M3.js";import"./chevron-down-CaFwAaZt.js";import"./index-Hnne6-4R.js";function Se({filters:a,filterOptions:x,onApplyFilters:P,onResetFilters:R}){const[m,c]=r.useState(""),[j,i]=r.useState("");r.useEffect(()=>{a.condition?(c("condition"),i(a.condition)):a.room?(c("room"),i(a.room)):a.faculty?(c("faculty"),i(a.faculty)):a.reportable_type?(c("reportable_type"),i(a.reportable_type)):(c(""),i(""))},[a]);const v=l=>{const d=l==="all"?"":l;i(d);let b={...a};m&&(b[m]=d),P(b)},C=()=>{c(""),i(""),R()},w=[{value:"condition",label:"Condition"},{value:"room",label:"Room"},{value:"faculty",label:"Faculty"},{value:"reportable_type",label:"Report Type"}];return e.jsxs(fe,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(u,{className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Filter",(a.condition||a.room||a.faculty||a.reportable_type)&&e.jsx(Y,{className:"h-4 w-4 ml-1 cursor-pointer",onClick:l=>{l.stopPropagation(),l.preventDefault(),C()}})]})}),e.jsxs(ye,{className:"w-[calc(100vw-2rem)] sm:w-[400px] p-4",children:[e.jsx("h4",{className:"font-medium mb-3 text-lg",children:"Filter Options"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(f,{value:m,onValueChange:l=>{c(l),i("")},children:[e.jsx(g,{className:"w-full",children:e.jsx(y,{placeholder:"Select Field"})}),e.jsx(N,{children:w.map(l=>e.jsx(o,{value:l.value,children:l.label},l.value))})]}),m==="condition"&&e.jsxs(f,{value:j||"all",onValueChange:v,children:[e.jsx(g,{className:"w-full",children:e.jsx(y,{placeholder:"Select Condition"})}),e.jsxs(N,{children:[e.jsx(o,{value:"all",children:"All"}),x.conditions.map((l,d)=>e.jsx(o,{value:l,children:l},d))]})]}),m==="room"&&e.jsxs(f,{value:j||"all",onValueChange:v,children:[e.jsx(g,{className:"w-full",children:e.jsx(y,{placeholder:"Select Room"})}),e.jsxs(N,{children:[e.jsx(o,{value:"all",children:"All"}),Object.entries(x.rooms).map(([l,d])=>e.jsxs(o,{value:l,children:["Room ",d]},l))]})]}),m==="faculty"&&e.jsxs(f,{value:j||"all",onValueChange:v,children:[e.jsx(g,{className:"w-full",children:e.jsx(y,{placeholder:"Select Faculty"})}),e.jsxs(N,{children:[e.jsx(o,{value:"all",children:"All"}),Object.entries(x.faculties).map(([l,d])=>e.jsx(o,{value:l,children:d},l))]})]}),m==="reportable_type"&&e.jsxs(f,{value:j||"all",onValueChange:v,children:[e.jsx(g,{className:"w-full",children:e.jsx(y,{placeholder:"Select Type"})}),e.jsxs(N,{children:[e.jsx(o,{value:"all",children:"All"}),x.reportable_types.map(l=>e.jsx(o,{value:l,children:l},l))]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(u,{size:"sm",variant:"outline",onClick:C,className:"w-auto px-3",children:[e.jsx(Y,{className:"mr-1 h-4 w-4"})," Reset"]})})]})]})]})}function rs({reports:a,filters:x={},filterOptions:P}){const[R,m]=r.useState(a),[c,j]=r.useState(x.search||""),[i,v]=r.useState(null),[C,w]=r.useState(!1),l=s=>{v(s),w(!0)},[d,b]=r.useState(!1),[S,z]=r.useState(a),[_,D]=r.useState(""),[L,T]=r.useState(""),[A,Z]=r.useState(!1),ee=s=>{z(s),D(s.condition),T(""),b(!0)},se=s=>{if(!_){O.fire({icon:"warning",title:"Select Condition",text:"Please select a new condition before resolving."});return}Z(!0),B.post(`/admin/faculty-reports/${s.id}/resolve`,{report_id:s.id,old_condition:s.condition,new_condition:_,details:L},{onSuccess:()=>{b(!1),z(null),D(""),T(""),O.fire({icon:"success",title:"Resolved!",text:`Report #${s.id} has been successfully resolved.`,timer:2e3,showConfirmButton:!1}),m(h=>h.map(k=>k.id===s.id?{...k,resolved:!0,condition:_}:k))},onError:()=>{O.fire({icon:"error",title:"Error",text:"Failed to resolve report. Please try again."})}})},[p,V]=r.useState(1),F=10,q=Math.ceil(R.length/F),H=R.slice((p-1)*F,p*F);function M(s){const h=Object.fromEntries(Object.entries(s).filter(([k,U])=>U!==""&&U!==void 0));B.get(route("admin.reports.index"),{...h,search:c||void 0})}function le(){j(""),B.get(route("admin.reports.index"))}function ae(s){s.key==="Enter"&&M(x)}return e.jsxs(oe,{children:[e.jsx(ve,{}),e.jsxs(ne,{children:[e.jsx("header",{className:"sticky top-0 z-20 bg-white border-b px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{}),e.jsx(ce,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(pe,{children:e.jsx(ue,{children:e.jsxs(je,{children:[e.jsx(J,{href:"#","aria-current":"page",children:"Reports"}),e.jsx(be,{}),e.jsx(J,{href:"/admin/faculty/reports","aria-current":"page",className:"font-semibold text-foreground",children:"Faculty Reports"})]})})}),e.jsx("div",{className:"flex-1"}),e.jsx(de,{})]})}),e.jsx("main",{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-5",children:"Faculty Reports"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[e.jsx(Se,{filters:x,filterOptions:P,onApplyFilters:M,onResetFilters:le}),e.jsx(Q,{placeholder:"Search reports...",value:c,onChange:s=>j(s.target.value),onKeyDown:ae,className:`flex-1 min-w-0 sm:max-w-xs w-full
             border-[hsl(142,34%,51%)] text-[hsl(142,34%,20%)]
             focus:border-[hsl(142,34%,45%)] focus:ring-[hsl(142,34%,45%)]
             placeholder:text-[hsl(142,34%,40%)]`})]}),e.jsx(te,{children:e.jsxs(re,{className:"p-0",children:[e.jsxs(he,{children:[e.jsx(me,{children:e.jsxs(E,{className:"bg-[hsl(142,34%,85%)] text-[hsl(142,34%,25%)] hover:bg-[hsl(142,34%,80%)]",children:[e.jsx(n,{children:"#"}),e.jsx(n,{children:"Faculty"}),e.jsx(n,{children:"Room"}),e.jsx(n,{children:"Reports Type"}),e.jsx(n,{children:"Reports ID"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Code"}),e.jsx(n,{children:"Condition"}),e.jsx(n,{children:"Remarks"}),e.jsx(n,{children:"Photo"}),e.jsx(n,{children:"Date Reported"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(xe,{children:H.length>0?H.map((s,h)=>e.jsxs(E,{children:[e.jsx(t,{children:(p-1)*F+h+1}),e.jsx(t,{children:s.user?.name||"N/A"}),e.jsxs(t,{children:["ROOM"," ",s.room?s.room.room_number:"N/A"]}),e.jsx(t,{children:s.reportable_type}),e.jsx(t,{children:s.reportable_id}),e.jsx(t,{children:s.reportable_type==="peripheral"?s.reportable?.type:s.reportable_type==="system_unit"?"System Unit":s.reportable_type==="equipment"?s.reportable?.equipment_type:"N/A"}),e.jsx(t,{children:s.reportable_type==="peripheral"?s.reportable?.peripheral_code:s.reportable_type==="system_unit"?s.reportable?.unit_code:s.reportable_type==="equipment"?s.reportable?.equipment_code:"N/A"}),e.jsx(t,{children:s.condition}),e.jsx(t,{children:s.remarks}),e.jsx(t,{children:s.photo_url?e.jsx("img",{src:s.photo_url,alt:"Report",className:"w-16 h-16 object-cover rounded cursor-pointer hover:shadow-lg",onClick:()=>l(s.photo_url)}):"No photo"}),e.jsx(t,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(t,{children:e.jsx("div",{className:"flex gap-2",children:s.resolved?e.jsxs("span",{className:"text-sm font-medium text-green-600 flex items-center gap-1",children:[e.jsx(W,{className:"w-4 h-4"}),"Resolved"]}):e.jsxs(u,{size:"sm",variant:"secondary",className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",onClick:()=>ee(s),children:[e.jsx(W,{className:"w-4 h-4"}),"Resolve"]})})})]},s.id)):e.jsx(E,{children:e.jsx(t,{colSpan:"11",className:"text-center",children:"No reports found."})})})]}),e.jsxs("div",{className:"flex justify-center mt-4 space-x-2",children:[e.jsx(u,{variant:"outline",size:"sm",disabled:p===1,onClick:()=>V(p-1),children:"Previous"}),[...Array(q)].map((s,h)=>e.jsx(u,{variant:p===h+1?"default":"outline",size:"sm",onClick:()=>V(h+1),children:h+1},h)),e.jsx(u,{variant:"outline",size:"sm",disabled:p===q,onClick:()=>V(p+1),children:"Next"})]})]})})]})}),e.jsx($,{open:C,onOpenChange:w,children:e.jsxs(K,{className:"flex flex-col items-center",children:[e.jsx(X,{children:e.jsx(G,{children:"Report Photo"})}),i&&e.jsx("img",{src:i,alt:"Report",className:"max-w-full max-h-[80vh] object-contain rounded"})]})}),e.jsx($,{open:d,onOpenChange:b,children:e.jsxs(K,{className:"max-w-md w-full",children:[e.jsx(X,{children:e.jsxs(G,{children:["Resolve Report #",S?.id]})}),e.jsxs("div",{className:"flex flex-col gap-4 mt-2",children:[S?.remarks&&e.jsxs("div",{children:[e.jsx(I,{className:"text-gray-600",children:"Remarks"}),e.jsx("div",{className:"border rounded-md p-2 text-sm bg-gray-50",children:S.remarks})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Condition"}),e.jsxs(f,{value:_||S?.condition,onValueChange:D,children:[e.jsx(g,{children:e.jsx(y,{placeholder:"Select Condition"})}),e.jsxs(N,{children:[e.jsx(o,{value:"Functional",children:"Functional"}),e.jsx(o,{value:"Needs Repair",children:"Needs Repair"}),e.jsx(o,{value:"Replaced",children:"Replaced"}),e.jsx(o,{value:"Not Repairable",children:"Not Repairable"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Resolution Details"}),e.jsx(Q,{type:"text",placeholder:"Describe how you fixed it...",value:L,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx(u,{variant:"outline",onClick:()=>b(!1),disabled:A,children:"Cancel"}),e.jsx(u,{onClick:()=>se(S),variant:"secondary",disabled:A,children:A?"Saving...":"Save"})]})]})]})})]})]})}export{rs as default};
