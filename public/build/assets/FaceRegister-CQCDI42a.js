import{r as s,j as a,a as h}from"./app-Bif1K73z.js";import{A as x}from"./AuthenticatedLayout-Bc_1rQ8P.js";import{n as i,d as y,T as w}from"./FaceMatcher-uHkuQCPQ.js";import{B as j}from"./button-yugozLbP.js";import{C as b,b as C,c as F,a as N}from"./card-ibYWTEVa.js";import"./transition-DCSWZoFC.js";import"./index-BfaenBt4.js";import"./utils-CBfrqCZ4.js";const v=r=>r.charAt(0).toUpperCase()+r.slice(1);function O({user:r}){const o=s.useRef(),[d,e]=s.useState("Loading models..."),[n,c]=s.useState(!1);s.useEffect(()=>{m()},[]);async function m(){try{await i.tinyFaceDetector.loadFromUri("/models"),await i.faceRecognitionNet.loadFromUri("/models"),await i.faceLandmark68TinyNet.loadFromUri("/models"),e("Models loaded! Starting camera..."),u()}catch(t){console.error("Model loading error:",t),e("‚ö†Ô∏è Error loading models. Check console.")}}async function u(){try{const t=await navigator.mediaDevices.getUserMedia({video:!0});o.current.srcObject=t,e("Camera ready! Look directly at the camera.")}catch(t){console.error("Camera access error:",t),e("Please allow camera access to continue.")}}async function f(){c(!0),e("Detecting face...");try{const t=await y(o.current,new w).withFaceLandmarks(!0).withFaceDescriptor();if(!t){e("‚ùå No face detected. Please try again."),c(!1);return}const p=Array.from(t.descriptor);e("‚úÖ Face detected! Saving...");const l=await(await fetch("/register-face",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({descriptor:p}),credentials:"include"})).json();if(l.success){e("üéâ Face registered successfully!");const g={admin:"/admin/dashboard",faculty:"/faculty/dashboard",technician:"/technician/dashboard"}[l.role]||"/dashboard";setTimeout(()=>h.visit(g),1500)}else e("‚ùå Failed to save face data. Try again.")}catch(t){console.error("Detection error:",t),e("‚ö†Ô∏è Error detecting face. Check console.")}c(!1)}return a.jsx(x,{header:a.jsx("h2",{className:"text-2xl font-semibold leading-tight text-gray-800 text-center",children:r?.role?`${v(r.role)} Profile`:"Admin Profile"}),children:a.jsx("div",{className:"flex flex-col items-center justify-center  bg-gray-50 p-4",children:a.jsxs(b,{className:"max-w-lg w-full shadow-lg rounded-xl overflow-hidden",children:[a.jsx(C,{className:"bg-gray-100 text-center",children:a.jsx(F,{className:"text-2xl font-bold",children:"Register Your Face"})}),a.jsxs(N,{className:"flex flex-col items-center gap-6 p-6",children:[a.jsx("video",{ref:o,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full max-w-md h-64 rounded-lg border border-gray-300 shadow-sm object-cover"}),a.jsx(j,{type:"button",onClick:f,disabled:n,className:"w-full sm:w-auto",children:n?"Processing...":"Capture & Save Face"}),a.jsx("p",{className:"text-gray-600 text-sm text-center",children:d})]})]})})})}export{O as default};
