import{r as s,j as e,a as d}from"./app-CHPRVSDN.js";import{A as b}from"./AuthenticatedLayout-B5efLejB.js";import{n as i,d as j,T as v}from"./FaceMatcher-uHkuQCPQ.js";import{B as m}from"./button-Bxe13RqE.js";import{C as w,b as N,c as C,a as F}from"./card-BVN3bhgA.js";import"./transition-CyL97sNV.js";import"./index-BZdXc2Fg.js";import"./utils-CBfrqCZ4.js";const R=r=>r.charAt(0).toUpperCase()+r.slice(1);function M({user:r}){const o=s.useRef(),f=s.useRef(),[u,t]=s.useState("Loading models..."),[n,c]=s.useState(!1);s.useEffect(()=>{h()},[]);async function h(){try{await i.tinyFaceDetector.loadFromUri("/models"),await i.faceRecognitionNet.loadFromUri("/models"),await i.faceLandmark68TinyNet.loadFromUri("/models"),t("Models loaded! Starting camera..."),g()}catch(a){console.error("Model loading error:",a),t("âš ï¸ Error loading models. Check console.")}}async function g(){try{const a=await navigator.mediaDevices.getUserMedia({video:!0});o.current.srcObject=a,t("Camera ready! Look directly at the camera.")}catch(a){console.error("Camera access error:",a),t("Please allow camera access to continue.")}}async function p(){c(!0),t("Detecting face...");try{const a=await j(o.current,new v).withFaceLandmarks(!0).withFaceDescriptor();if(!a){t("âŒ No face detected. Please try again."),c(!1);return}const x=Array.from(a.descriptor);t("âœ… Face detected! Saving...");const l=await(await fetch("/register-face",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({descriptor:x}),credentials:"include"})).json();if(l.success){t("ðŸŽ‰ Face registered successfully!");const y={admin:"/admin/dashboard",faculty:"/faculty/dashboard",technician:"/technician/dashboard"}[l.role]||"/dashboard";setTimeout(()=>d.visit(y),1500)}else t("âŒ Failed to save face data. Try again.")}catch(a){console.error("Detection error:",a),t("âš ï¸ Error detecting face. Check console.")}c(!1)}return e.jsx(b,{header:e.jsx("h2",{className:"text-2xl font-semibold leading-tight text-gray-800 text-center",children:r?.role?`${R(r.role)} Profile`:"Admin Profile"}),children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[80vh] bg-gradient-to-br from-gray-100 via-gray-50 to-gray-100 p-4",children:e.jsxs(w,{className:"max-w-md w-full shadow-2xl rounded-3xl backdrop-blur-md bg-white/60 overflow-hidden",children:[e.jsx(N,{className:"bg-gray-100 text-center py-4",children:e.jsx(C,{className:"text-2xl font-bold",children:"Register Your Face"})}),e.jsxs(F,{className:"flex flex-col items-center gap-6 p-6 relative",children:[e.jsxs("div",{className:"relative w-64 h-64 rounded-full overflow-hidden border-4 border-gray-300 shadow-lg ring-2 ring-indigo-500 ring-offset-2 ring-offset-white animate-pulse",children:[e.jsx("video",{ref:o,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("div",{ref:f,className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-44 h-44 border-2 border-dashed border-indigo-400 rounded-full"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full justify-center mt-4",children:[e.jsx(m,{type:"button",onClick:p,disabled:n,className:"flex-1 sm:flex-none shadow-md",children:n?"Processing...":"Capture & Save Face"}),e.jsx(m,{type:"button",variant:"outline",onClick:()=>d.visit("/profile"),className:"flex-1 sm:flex-none",children:"Back"})]}),e.jsx("p",{className:"text-gray-700 text-sm text-center mt-2 font-medium",children:u})]})]})})})}export{M as default};
