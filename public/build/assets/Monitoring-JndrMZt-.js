import{r as s,j as e,H as ee,R as te,c as C}from"./app-BIwlyt8C.js";import{S as se,a as ae,b as re,c as ne}from"./avatar-C4XO60we.js";import{A as oe}from"./app-sidebar-D3sVUVD4.js";import{N as le}from"./Notification-DKVJWeTh.js";import{C as D,b as T,c as P,a as R}from"./card-C0RzOCM5.js";import{B as ie,a as ce,b as de,c as me}from"./breadcrumb-Dq-G1BxX.js";import{B as he}from"./badge-BV3bo58k.js";import{T as xe,f as ue,a as ge,b as v,c,d as pe,e as o}from"./table-DwQ2yeli.js";import{I as A}from"./input-DuJpVvIv.js";import{B as l}from"./button-Cvjh1GZ1.js";import{F as fe}from"./funnel-CTLZA15S.js";import"./index-CIhkfTGN.js";import"./utils-CBfrqCZ4.js";import"./index-_GrsYgzc.js";import"./index-DeiY3fR0.js";import"./createLucideIcon-B8B2iXso.js";import"./index-CROv15xz.js";import"./dropdown-menu-COXCHGXD.js";import"./index-PtQ2pING.js";import"./chevron-right-CPQRjjEL.js";import"./index-ZmtpnWyZ.js";import"./index-CC1TizNa.js";import"./house-Ch_sl3RI.js";import"./user-B5GN24-g.js";import"./log-out-BsUZLdLy.js";import"./keyboard-DMtpdZmG.js";import"./boxes-CK2rTsmI.js";import"./users-CNhX2TRz.js";import"./chevron-down-CBOqi84k.js";import"./bell-FiFxLgBB.js";function Xe({children:je}){const[N,I]=s.useState([]),[i,$]=s.useState([]),[w,be]=s.useState(1),[ye,H]=s.useState(1),[r,x]=s.useState(1),[u,F]=s.useState(1),[_,k]=s.useState(0),m=10,[g,B]=s.useState(""),[z,O]=s.useState([]),[M,E]=s.useState([]),[p,U]=s.useState(""),[f,G]=s.useState(""),[h,S]=s.useState(""),[j,W]=s.useState(!1),[d,q]=s.useState(new Date),L=async()=>{try{const t=await C.get(`/api/admin/rooms-status?page=${w}&per_page=${m}`);I(t.data.data),H(t.data.meta.total_pages)}catch(t){console.error("Failed to fetch rooms:",t)}},b=async()=>{try{const t=await C.get("/admin/faculty-logs",{params:{page:r,search:g,faculty_id:p,room_id:f,log_date:h}});$(t.data.logs.data||[]),F(t.data.logs.last_page||1),k(t.data.logs.total||0),t.data.facultyOptions&&O(t.data.facultyOptions),t.data.roomOptions&&E(t.data.roomOptions)}catch(t){console.error("Failed to fetch logs:",t)}};s.useEffect(()=>{L();const t=setInterval(L,5e3);return()=>clearInterval(t)},[w]),s.useEffect(()=>{b();const t=setInterval(b,5e3);return()=>clearInterval(t)},[r,g,p,f,h]),s.useEffect(()=>{const t=setInterval(()=>q(new Date),1e3);return()=>clearInterval(t)},[]);const J=d.getHours()%12||12,K=String(d.getMinutes()).padStart(2,"0"),Q=String(d.getSeconds()).padStart(2,"0"),V=d.getHours()>=12?"PM":"AM",X=()=>{if(i.length===0){alert("No logs available to generate report.");return}const t=window.open("","","width=1000,height=800"),n=i.map((a,y)=>{const Y=a.created_at?new Date(a.created_at.replace(" ","T")).toLocaleString("en-PH",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"—",Z=a.logged_out_at?new Date(a.logged_out_at.replace(" ","T")).toLocaleString("en-PH",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"—";return`
                <tr>
                    <td>${y+1}</td>
                    <td>${a.faculty?.name??"N/A"}</td>
                    <td>${a.faculty?.role??"N/A"}</td>
                    <td>${Y}</td>
                    <td>${Z}</td>
                    <td>${a.room?.room_number??"N/A"}</td>
                </tr>
            `}).join("");t.document.write(`
        <html>
            <head>
                <title>Faculty Logs Report</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    .header { text-align: center; margin-bottom: 20px; }
                    .logo { width: 80px; height: 80px; object-fit: contain; margin-bottom: 10px; }
                    h1 { font-size: 24px; margin: 0; color: #2e7d32; }
                    p { text-align: center; font-size: 14px; margin: 5px 0; color: #555; }
                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; font-size: 13px; }
                    th { background-color: #2e7d32; color: white; }
                    tr:nth-child(even) { background-color: #f9f9f9; }
                    .summary { margin-top: 20px; font-size: 14px; }
                </style>
            </head>
            <body>
                <div class="header">
                    <img src="/logo.png" class="logo" alt="School Logo" />
                    <h1>Smart Inventory Management System</h1>
                    <p>Faculty Logs Report</p>
                    <p>Generated on: ${new Date().toLocaleString()}</p>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>User</th>
                            <th>Role</th>
                            <th>Login Date</th>
                            <th>Logout Date</th>
                            <th>Room</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${n}
                    </tbody>
                </table>

                <div class="summary">
                    <strong>Total Logs:</strong> ${i.length}
                </div>
            </body>
        </html>
    `),t.document.close(),t.print()};return e.jsxs(se,{children:[e.jsx(ee,{children:e.jsx("title",{children:"Dashboard"})}),e.jsx(oe,{}),e.jsxs(ae,{children:[e.jsx("header",{className:"sticky top-0 z-20 bg-white border-b px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{}),e.jsx(ne,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(ie,{children:e.jsx(ce,{children:e.jsx(de,{children:e.jsx(me,{href:"/admin/monitoring","aria-current":"page",className:"font-semibold text-foreground",children:"Monitoring"})})})}),e.jsx("div",{className:"flex-1"}),e.jsx(le,{})]})}),e.jsx("main",{className:"w-full px-6 py-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Room Monitoring"}),e.jsx("div",{className:"mb-6",children:e.jsxs("span",{className:"text-gray-800 text-3xl md:text-4xl font-bold",children:[d.toLocaleDateString("en-PH",{weekday:"long",year:"numeric",month:"long",day:"numeric"})," ","at ",J,":",K,":",Q," ",V]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4 mb-8",children:[N.length===0&&e.jsx("p",{className:"col-span-full text-center text-gray-500",children:"No rooms found."}),N.map(t=>e.jsxs(D,{className:`rounded-2xl transition-all duration-200 ease-in-out shadow-md
                                                hover:scale-[1.02] hover:shadow-lg
                                                ${t.is_active?"bg-[#59AC77] border border-green-700 text-white":"bg-[#59AC77] border border-gray-300 text-gray-900"}`,children:[e.jsxs(T,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(P,{className:`text-lg md:text-xl font-semibold ${t.is_active?"text-white":"text-gray-900"}`,children:t.name}),e.jsx(he,{className:`px-3 py-1 text-xs font-medium rounded-full ${t.is_active?"bg-white text-green-700":"bg-gray-500 text-white"}`,children:t.is_active?"Active":"Inactive"})]}),e.jsx(R,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[t.is_active&&t.last_scanned_user?.photo?e.jsx("img",{src:t.last_scanned_user.photo,alt:t.last_scanned_user.name,className:"w-28 h-28 rounded-full object-cover border-4 border-green-500 shadow-md"}):e.jsx("div",{className:"w-28 h-28 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 text-sm border-4 border-gray-300 shadow-md",children:"No Photo"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`font-medium ${t.is_active?"text-white":"text-gray-900"}`,children:t.is_active&&t.last_scanned_user?`${t.last_scanned_user.name} (${t.last_scanned_user.role})`:"No Faculty"}),e.jsx("span",{className:`text-xs ${t.is_active?"text-green-100":"text-gray-600"}`,children:t.is_active&&t.last_scanned_at?new Date(t.last_scanned_at).toLocaleString("en-PH",{hour12:!0}):"Not yet scanned"})]})]})})]},t.id))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between w-full mb-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",onClick:()=>W(!j),children:[e.jsx(fe,{className:"w-4 h-4"}),j?"Hide Filters":"Show Filters"]}),e.jsx(l,{className:"bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",onClick:X,children:"Generate Report"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{type:"text",placeholder:"Search by faculty or room...",value:g,onChange:t=>B(t.target.value),className:"w-64"}),e.jsx(l,{onClick:b,className:"bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",children:"Search"})]})]}),j&&e.jsxs("div",{className:"flex flex-wrap gap-5 items-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1",children:"Users"}),e.jsxs("select",{value:p,onChange:t=>U(t.target.value),className:"h-9 w-44 px-2 py-1 text-sm border rounded-md focus:ring-2 focus:ring-[hsl(142,34%,51%)] focus:outline-none",children:[e.jsx("option",{value:"",children:"All"}),z.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1",children:"Room"}),e.jsxs("select",{value:f,onChange:t=>G(t.target.value),className:"h-9 w-44 px-2 py-1 text-sm border rounded-md focus:ring-2 focus:ring-[hsl(142,34%,51%)] focus:outline-none",children:[e.jsx("option",{value:"",children:"All"}),M.map(t=>e.jsx("option",{value:t.id,children:t.room_number},t.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1",children:"Login Date"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{type:"date",value:h,onChange:t=>S(t.target.value),className:"h-9 w-44 text-sm border rounded-md focus:ring-2 focus:ring-[hsl(142,34%,51%)] focus:outline-none"}),h&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>S(""),className:"text-xs border-gray-300",children:"Clear"})]})]})]}),e.jsxs(D,{className:"shadow-md rounded-2xl",children:[e.jsx(T,{children:e.jsx(P,{children:"Users Logs History"})}),e.jsxs(R,{children:[e.jsxs(xe,{children:[e.jsx(ue,{children:"A list of recent faculty room logs."}),e.jsx(ge,{children:e.jsxs(v,{className:"bg-[hsl(142,34%,85%)] text-[hsl(142,34%,25%)] hover:bg-[hsl(142,34%,80%)] h-10",children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"User"}),e.jsx(c,{children:"Role"}),e.jsx(c,{children:"Login Date"}),e.jsx(c,{children:"Logout Date"}),e.jsx(c,{children:"Room"})]})}),e.jsxs(pe,{children:[i.length===0&&e.jsx(v,{children:e.jsx(o,{colSpan:6,className:"text-center text-gray-500",children:"No logs found."})}),i.map((t,n)=>{const a=t.created_at?new Date(t.created_at.replace(" ","T")).toLocaleString("en-PH",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"—",y=t.logged_out_at?new Date(t.logged_out_at.replace(" ","T")).toLocaleString("en-PH",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"";return e.jsxs(v,{children:[e.jsx(o,{children:n+1+(r-1)*m}),e.jsx(o,{children:t.faculty?.name??"N/A"}),e.jsx(o,{children:t.faculty?.role??"N/A"}),e.jsx(o,{children:a}),e.jsx(o,{children:y}),e.jsx(o,{children:t.room?.room_number??"N/A"})]},t.id)})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing"," ",i.length===0?0:(r-1)*m+1," ","–"," ",Math.min(r*m,_)," ","of ",_," Logs"]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(l,{size:"sm",variant:"outline",disabled:r===1,onClick:()=>x(t=>t-1),children:"Previous"}),Array.from({length:u},(t,n)=>n+1).filter(t=>t===1||t===u?!0:t>=r-2&&t<=r+2).map((t,n,a)=>e.jsxs(te.Fragment,{children:[n>0&&a[n]-a[n-1]>1&&e.jsx("span",{className:"px-1",children:"..."}),e.jsx(l,{size:"sm",variant:r===t?"default":"outline",onClick:()=>x(t),children:t})]},t)),e.jsx(l,{size:"sm",variant:"outline",disabled:r===u,onClick:()=>x(t=>t+1),children:"Next"})]})]})]})]})]})]})})]})]})}export{Xe as default};
