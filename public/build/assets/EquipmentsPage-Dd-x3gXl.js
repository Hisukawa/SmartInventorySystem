import{r as d,j as e,a as D,R as oe}from"./app-BIwlyt8C.js";import{B as i}from"./button-Cvjh1GZ1.js";import{A as ae}from"./app-sidebar-D3sVUVD4.js";import{S as re,a as ce,b as de,c as me}from"./avatar-C4XO60we.js";import{I as xe}from"./input-DuJpVvIv.js";import{N as he}from"./Notification-DKVJWeTh.js";import pe from"./EditEquipmentPage-DMa2Rq2V.js";import{Q as ue}from"./index-BHqbGeDj.js";import{S as ge,J as je,R as fe,F as be}from"./server.browser-x93LCpRi.js";import{C as H}from"./checkbox-Ds7aHkjT.js";import{T as Ne,a as we,b as F,c as v,d as ye,e as j}from"./table-DwQ2yeli.js";import{B as ve,a as Ce,b as Se,c as U,d as Re}from"./breadcrumb-Dq-G1BxX.js";import{P as Ee,a as _e,b as ke}from"./popover-uK11uE3a.js";import{S as A,a as P,b as T,c as $,d as m}from"./select-Cn-9VPP9.js";import{P as qe}from"./printer-CX5p0_fq.js";import{E as W}from"./eye-FRpkXrUi.js";import{P as J}from"./pen-UmBT7AwN.js";import{l as q,E as Ae}from"./menu-CWsvvpZy.js";import{F as Pe}from"./funnel-CTLZA15S.js";import"./index-CIhkfTGN.js";import"./utils-CBfrqCZ4.js";import"./dropdown-menu-COXCHGXD.js";import"./index-_GrsYgzc.js";import"./index-CROv15xz.js";import"./index-PtQ2pING.js";import"./createLucideIcon-B8B2iXso.js";import"./chevron-right-CPQRjjEL.js";import"./house-Ch_sl3RI.js";import"./user-B5GN24-g.js";import"./log-out-BsUZLdLy.js";import"./keyboard-DMtpdZmG.js";import"./boxes-CK2rTsmI.js";import"./users-CNhX2TRz.js";import"./chevron-down-CBOqi84k.js";import"./index-DeiY3fR0.js";import"./index-ZmtpnWyZ.js";import"./index-CC1TizNa.js";import"./bell-FiFxLgBB.js";import"./dialog-C_6Sayg6.js";import"./index-CXcRdS9j.js";import"./portal-CG5L1WZv.js";import"./with-selector-FEtfw_px.js";const Te={Working:"bg-green-200 text-green-800","Not Working":"bg-red-200 text-red-800","Intermittent Issue":"bg-yellow-200 text-yellow-800","Needs Cleaning":"bg-blue-200 text-blue-800","For Replacement":"bg-orange-200 text-orange-800","For Disposal":"bg-gray-200 text-gray-800",Condemned:"bg-black text-white","Minor Damage":"bg-yellow-200 text-yellow-800","Needs Repair":"bg-red-200 text-red-800","Intermittent Connectivity":"bg-yellow-200 text-yellow-800","No Signal":"bg-red-200 text-red-800","Needs Configuration":"bg-blue-200 text-blue-800",Expired:"bg-red-300 text-red-900","Needs Refill":"bg-blue-200 text-blue-900",Rusting:"bg-orange-200 text-orange-900","To Be Diagnosed":"bg-blue-100 text-blue-700"};function $e({filters:o,filterOptions:p,onApplyFilters:E}){const[r,f]=d.useState(""),[c,_]=d.useState(""),b=n=>{const x=n==="all"?"":n;_(x),r==="type"?E({...o,type:x}):r==="condition"?E({...o,condition:x}):r==="room"&&E({...o,room_id:x})},C=()=>{f(""),_(""),E({type:"",condition:"",room_id:""})};return e.jsxs(Ee,{children:[e.jsx(_e,{asChild:!0,children:e.jsxs(i,{className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",children:[e.jsx(Pe,{className:"h-4 w-4"})," ","Filters"]})}),e.jsx(ke,{className:"w-72",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(A,{value:r,onValueChange:n=>{f(n),_("")},children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Select filter field"})}),e.jsxs($,{children:[e.jsx(m,{value:"type",children:"Type"}),e.jsx(m,{value:"condition",children:"Condition"}),e.jsx(m,{value:"room",children:"Room"})]})]}),r==="type"&&e.jsxs(A,{value:c||"all",onValueChange:b,children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Select Type"})}),e.jsxs($,{children:[e.jsx(m,{value:"all",children:"All"}),p.types.map(n=>e.jsx(m,{value:n,children:n},n))]})]}),r==="condition"&&e.jsxs(A,{value:c||"all",onValueChange:b,children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Select Condition"})}),e.jsxs($,{children:[e.jsx(m,{value:"all",children:"All"}),p.conditions.map(n=>e.jsx(m,{value:n,children:n},n))]})]}),r==="room"&&e.jsxs(A,{value:c||"all",onValueChange:b,children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Select Room"})}),e.jsxs($,{children:[e.jsx(m,{value:"all",children:"All"}),Object.entries(p.rooms).map(([n,x])=>e.jsxs(m,{value:n,children:["Room ",x]},n))]})]}),(r||c)&&e.jsx("div",{className:"flex justify-end",children:e.jsx(i,{size:"sm",variant:"outline",onClick:C,className:"flex items-center gap-1 text-red-600 hover:bg-red-50",children:"Reset"})})]})})]})}function St({equipments:o,existingRooms:p,filters:E={}}){const[r,f]=d.useState(!1),[c,_]=d.useState(null),[b,C]=d.useState([]),[n,x]=d.useState(!1),G=t=>{_(t),C([]),x(!1)},Z=()=>{if(n)C([]);else if(c){const t=o.filter(s=>s.room_id===c).map(s=>s.id);C(t)}x(!n)},K=t=>{C(s=>s.includes(t)?s.filter(l=>l!==t):[...s,t])},X=async()=>{if(b.length===0){alert("Select at least one equipment.");return}const t=o.filter(l=>b.includes(l.id)),s=new je;for(const l of t){const u=`${window.location.origin}/equipment/${l.equipment_code}`,R=fe.renderToString(e.jsx(ue,{value:u,size:256})),I=new Blob([R],{type:"image/svg+xml"}),B=URL.createObjectURL(I),g=new Image;await new Promise(ne=>{g.onload=()=>{const w=document.createElement("canvas");w.width=g.width+40,w.height=g.height+40+50;const y=w.getContext("2d");y.fillStyle="#fff",y.fillRect(0,0,w.width,w.height),y.drawImage(g,20,20),y.fillStyle="#000",y.font="bold 18px Arial",y.textAlign="center",y.fillText(`Room ${l.room?.room_number} - ${l.equipment_code}`,w.width/2,g.height+20+30),w.toBlob(ie=>{s.file(`${l.equipment_code}.png`,ie),ne()},"image/png")},g.src=B}),URL.revokeObjectURL(B)}s.generateAsync({type:"blob"}).then(l=>{be.saveAs(l,"Equipment_QR_Codes.zip")})},[L,Y]=d.useState(""),[a,k]=d.useState(1),[N,O]=d.useState({}),S=10,ee=d.useMemo(()=>{const t=s=>[...new Set(s.filter(Boolean))].sort();return{types:t(o.map(s=>s.type)),conditions:t(o.map(s=>s.condition)),rooms:Object.fromEntries(p.map(s=>[String(s.id),s.room_number]))}},[o,p]),[M,z]=d.useState({open:!1,equipmentCode:null}),h=o.filter(t=>{const s=t.equipment_code.toLowerCase().includes(L.toLowerCase())||t.equipment_name.toLowerCase().includes(L.toLowerCase()),l=!N.type||t.type===N.type,u=!N.condition||t.condition===N.condition,R=!N.room||t.room?.id===parseInt(N.room);return s&&l&&u&&R});[...h].sort((t,s)=>{const l=parseInt(t.room?.room_number||0),u=parseInt(s.room?.room_number||0);if(l!==u)return l-u;const R=t.equipment_name?.toLowerCase()||"",I=s.equipment_name?.toLowerCase()||"";if(R!==I)return R.localeCompare(I,void 0,{numeric:!0});const B=t.equipment_code?.toLowerCase()||"",g=s.equipment_code?.toLowerCase()||"";return B.localeCompare(g,void 0,{numeric:!0})});const V=Math.ceil(h.length/S)||1,Q=h.slice((a-1)*S,a*S),te=()=>{if(!h||h.length===0){alert("No data available to print.");return}const t=window.open("","","width=900,height=700"),s=h.map((l,u)=>`
            <tr>
                <td>${u+1}</td>
                <td>${l.equipment_code}</td>
                <td>${l.equipment_name}</td>
                <td>${l.room?.room_number??"N/A"}</td>
                <td>${l.type}</td>
                <td>${l.condition??"N/A"}</td>
            </tr>
        `).join("");t.document.write(`
            <html>
                <head>
                    <title>Equipment Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h2 { text-align: center; margin-bottom: 20px; color: #2e7d32; }
                        p { text-align: right; font-size: 12px; color: #666; }
                        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; font-size: 13px; }
                        th { background-color: #2e7d32; color: white; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        @media print { body { -webkit-print-color-adjust: exact; } }
                    </style>
                </head>
                <body>
                    <h2>Equipment Report</h2>
                    <p>Generated on: ${new Date().toLocaleString()}</p>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Equipment Code</th>
                                <th>Equipment Name</th>
                                <th>Room</th>
                                <th>Type</th>
                                <th>Condition</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${s}
                        </tbody>
                    </table>
                </body>
            </html>
        `),t.document.close(),t.print()},se=t=>{O(t),k(1)},le=()=>{O({}),k(1)};return e.jsxs(re,{children:[e.jsx(ae,{}),M.open&&e.jsx(pe,{equipment:o.find(t=>t.equipment_code===M.equipmentCode),rooms:p,onClose:()=>z({open:!1,equipmentCode:null})}),e.jsxs(ce,{children:[e.jsxs("header",{className:"sticky top-0 z-20 bg-white border-b px-6 py-3 flex items-center gap-2",children:[e.jsx(de,{}),e.jsx(me,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(ve,{children:e.jsx(Ce,{children:e.jsxs(Se,{children:[e.jsx(U,{href:"#",children:"Assets"}),e.jsx(Re,{}),e.jsx(U,{href:"/equipments",className:"font-semibold text-foreground",children:"Equipments"})]})})}),e.jsx("div",{className:"flex-1"}),e.jsx(he,{})]}),e.jsxs("main",{className:"w-full px-6 py-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-5",children:"Equipments"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch sm:items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex gap-2 items-center flex-1",children:[e.jsx(xe,{placeholder:"Search Equipment...",value:L,onChange:t=>Y(t.target.value),className:"flex-1 min-w-0 sm:max-w-xs w-full border-[hsl(142,34%,51%)]"}),e.jsx($e,{filters:N,filterOptions:ee,onApplyFilters:se,onReset:le}),e.jsxs(i,{onClick:te,className:"flex items-center gap-2 bg-[hsl(183,40%,45%)] text-white border-none hover:bg-[hsl(183,40%,38%)]",children:[e.jsx(qe,{className:"h-4 w-4"}),"Print"]}),e.jsx(i,{className:"bg-[hsl(142,34%,51%)] text-white hover:bg-[hsl(142,34%,45%)]",onClick:()=>f(!0),children:"Download QR Codes"})]}),e.jsx(i,{className:"bg-[hsl(142,31%,51%)] hover:bg-[hsl(142,31%,45%)] text-white",onClick:()=>D.visit("/equipments/addequipment"),children:"Add Equipment"})]}),e.jsxs("div",{className:"overflow-x-auto rounded-lg border",children:[e.jsxs(Ne,{className:"w-full table-auto text-center",children:[e.jsx(we,{children:e.jsxs(F,{className:"bg-[hsl(142,34%,85%)] text-[hsl(142,34%,25%)] hover:bg-[hsl(142,34%,80%)]",children:[e.jsx(v,{className:"px-5 py-1 text-center",children:"#"}),e.jsx(v,{className:"px-5 py-1 text-center",children:"Equipment Code"}),e.jsx(v,{className:"px-5 py-1 text-center",children:"Equipment Name"}),e.jsx(v,{className:"px-5 py-1 text-center",children:"Room"}),e.jsx(v,{className:"px-5 py-1 text-center",children:"Type"}),e.jsx(v,{className:"px-5 py-1 text-center",children:"Condition"}),e.jsx(v,{className:"px-5 py-1 text-center",children:"Actions"})]})}),e.jsx(ye,{children:Q.length>0?Q.map((t,s)=>e.jsxs(F,{className:"hover:shadow-sm",children:[e.jsx(j,{className:"px-5 py-2 align-middle",children:(a-1)*S+s+1}),e.jsx(j,{className:"px-5 py-2 align-middle",children:t.equipment_code}),e.jsx(j,{className:"px-5 py-2 align-middle",children:t.equipment_name}),e.jsxs(j,{className:"px-5 py-2 align-middle",children:["ROOM"," ",t.room?.room_number??"N/A"]}),e.jsx(j,{className:"px-5 py-2 align-middle",children:t.type}),e.jsx(j,{className:"px-5 py-2 align-middle",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Te[t.condition]||"bg-gray-200 text-gray-800"}`,children:t.condition})}),e.jsxs(j,{className:"px-5 py-2 align-middle",children:[e.jsxs("div",{className:"hidden sm:flex justify-center items-center gap-2",children:[e.jsxs(i,{size:"sm",className:"bg-[hsl(142,34%,51%)] text-white flex items-center gap-2",onClick:()=>D.visit(`/admin/equipments/${t.equipment_code}`),children:[e.jsx(W,{className:"h-4 w-4"})," ","View"]}),e.jsxs(i,{size:"sm",className:"bg-[hsl(142,34%,51%)] text-white flex items-center gap-2",onClick:()=>z({open:!0,equipmentCode:t.equipment_code}),children:[e.jsx(J,{className:"h-4 w-4"})," ","Edit"]})]}),e.jsx("div",{className:"sm:hidden flex justify-center",children:e.jsxs(q,{as:"div",className:"relative inline-block text-left",children:[e.jsx(q.Button,{className:"p-2 rounded bg-[hsl(142,34%,51%)] text-white",children:e.jsx(Ae,{className:"h-5 w-5"})}),e.jsx(q.Items,{className:"absolute right-0 mt-2 w-28 origin-top-right bg-white border border-gray-200 divide-y divide-gray-100 rounded-md shadow-lg focus:outline-none z-50",children:e.jsxs("div",{className:"px-1 py-1",children:[e.jsx(q.Item,{children:({active:l})=>e.jsxs("button",{className:`${l?"bg-[hsl(142,34%,90%)]":""} group flex w-full items-center rounded-md px-2 py-2 text-sm text-gray-700`,onClick:()=>D.visit(`/admin/equipments/${t.equipment_code}`),children:[e.jsx(W,{className:"h-4 w-4 mr-2"})," ","View"]})}),e.jsx(q.Item,{children:({active:l})=>e.jsxs("button",{className:`${l?"bg-[hsl(142,34%,90%)]":""} group flex w-full items-center rounded-md px-2 py-2 text-sm text-gray-700`,onClick:()=>z({open:!0,equipmentCode:t.equipment_code}),children:[e.jsx(J,{className:"h-4 w-4 mr-2"})," ","Edit"]})})]})})]})})]})]},t.id)):e.jsx(F,{children:e.jsx(j,{colSpan:7,className:"text-center py-4",children:"No equipments found."})})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing"," ",h.length===0?0:(a-1)*S+1," ","–"," ",Math.min(a*S,h.length)," ","of ",h.length," equipments"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",disabled:a===1,onClick:()=>k(a-1),children:"Previous"}),Array.from({length:V},(t,s)=>s+1).filter(t=>t===1||t===V?!0:t>=a-2&&t<=a+2).map((t,s,l)=>e.jsxs(oe.Fragment,{children:[s>0&&l[s]-l[s-1]>1&&e.jsx("span",{className:"px-2",children:"..."}),e.jsx(i,{size:"sm",variant:a===t?"default":"outline",onClick:()=>k(t),children:t})]},t)),e.jsx(i,{size:"sm",variant:"outline",disabled:a===V,onClick:()=>k(a+1),children:"Next"})]})]})]}),e.jsxs("div",{className:`fixed top-0 right-0 h-full w-96 bg-white shadow-xl transform transition-transform duration-300 z-50 flex flex-col
${r?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Download Equipment QR Codes by Room"}),e.jsx(i,{variant:"ghost",onClick:()=>f(!1),children:"✕"})]}),e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("label",{className:"block mb-2 font-medium text-sm text-gray-700",children:"Select Room"}),e.jsxs(A,{value:c||"",onValueChange:t=>G(Number(t)),children:[e.jsx(P,{className:"w-full",children:e.jsx(T,{placeholder:"-- Select Room --"})}),e.jsx($,{children:p.map(t=>e.jsx(m,{value:t.id.toString(),children:t.room_number},t.id))})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b",children:[e.jsx(H,{checked:n,onCheckedChange:Z}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Select All Equipments in Room"})]}),c&&e.jsx(ge,{className:"flex-1 overflow-y-auto p-4 space-y-2",children:o.filter(t=>t.room_id===c).map(t=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-md hover:bg-gray-50 transition",children:[e.jsx(H,{checked:b.includes(t.id),onCheckedChange:()=>K(t.id)}),e.jsx("span",{className:"text-sm text-gray-800",children:t.equipment_code})]},t.id))}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx(i,{variant:"secondary",onClick:()=>f(!1),children:"Close"}),e.jsx(i,{className:"bg-[hsl(142,34%,51%)] text-white hover:bg-[hsl(142,34%,45%)]",onClick:X,children:"Download Selected"})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:()=>f(!1)})]})]})]})}export{St as default};
