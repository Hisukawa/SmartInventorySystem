import{r,u as k,j as e,a as b}from"./app-BKaA2yGR.js";import{Q as O}from"./index-MqVBHM6Z.js";import{T as ce,a as de,b as M,c,d as me,e as d,S as u}from"./table-Bug99fZC.js";import{I as S,B as a}from"./input-C64WjRa5.js";import{D as w,a as v,b as q,c as R}from"./dialog-B1DmhkDH.js";import{S as ue,A as xe,a as he,b as pe,c as ge,B as je,d as fe,e as be,f as Se}from"./breadcrumb-uT7Q8uCc.js";import"./index-nqN29aVq.js";import"./index-BIzPifR-.js";import"./index-ChSt_CXd.js";function ke({rooms:l,search:I}){const[C,Q]=r.useState(I||""),[A,x]=r.useState(!1),[L,m]=r.useState(!1),[P,H]=r.useState(null),[h,N]=r.useState(""),[p,y]=r.useState(""),[$,_]=r.useState(!1),[T,D]=r.useState(""),{data:U,setData:F,post:K,reset:X,processing:Y,errors:B}=k({room_number:""}),{data:G,setData:z,put:J,processing:V,errors:E,reset:W}=k({room_number:""}),Z=s=>{s.preventDefault(),K("/admin/rooms",{preserveScroll:!0,onSuccess:()=>{X(),x(!1),D("Room added successfully!"),setTimeout(()=>D(""),5e3)}})},ee=s=>{s.preventDefault(),J(`/admin/rooms/${P.id}`,{preserveScroll:!0,onSuccess:()=>{m(!1),W(),u.fire({icon:"success",title:"Room updated!",showConfirmButton:!1,timer:1500})},onError:()=>{u.fire({icon:"error",title:"Update failed!",text:"Please check your input."})}})},se=s=>{H(s),z("room_number",s.room_number),m(!0)},te=s=>{s.key==="Enter"&&b.get("/admin/rooms",{search:C})},re=(s,t)=>{s&&(N(s),y(t))},ae=()=>{const s=document.getElementById("qr-download"),n=new XMLSerializer().serializeToString(s),g=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),ie=URL.createObjectURL(g),j=new Image;j.onload=()=>{const o=document.createElement("canvas"),i=o.getContext("2d");o.width=220,o.height=260,i.fillStyle="#fff",i.fillRect(0,0,o.width,o.height),i.drawImage(j,10,10,200,200),i.fillStyle="#000",i.font="bold 16px sans-serif",i.textAlign="center",i.fillText(`ROOM ${p}`,o.width/2,235);const le=o.toDataURL("image/png"),f=document.createElement("a");f.href=le,f.download=`room-${p}-qr.png`,f.click()},j.src=ie},ne=async()=>{await navigator.clipboard.writeText(h),_(!0),setTimeout(()=>_(!1),2e3)},oe=s=>{u.fire({title:"Are you sure?",text:"This room will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"}).then(t=>{t.isConfirmed&&b.delete(`/admin/rooms/${s}`,{preserveScroll:!0,onSuccess:()=>{u.fire({icon:"success",title:"Deleted!",text:"The room has been deleted.",timer:1500,showConfirmButton:!1})}})})};return e.jsxs(ue,{children:[e.jsx(xe,{}),e.jsxs(he,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 border-b bg-white",children:[e.jsx(pe,{}),e.jsx(ge,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(je,{children:e.jsx(fe,{children:e.jsx(be,{children:e.jsx(Se,{href:"/admin/rooms","aria-current":"page",className:"font-semibold text-foreground",children:"Room Lists"})})})})]}),e.jsxs("main",{className:"w-full px-6 py-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h1",{className:"text-xl font-bold",children:"Room Management"})}),T&&e.jsx("div",{className:"mb-4 p-3 bg-green-100 text-green-800 rounded shadow text-sm",children:T}),e.jsx(w,{open:A,onOpenChange:x,children:e.jsxs(v,{children:[e.jsx(q,{children:e.jsx(R,{children:"Add New Room"})}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsx(S,{placeholder:"e.g. 101",value:U.room_number,onChange:s=>F("room_number",s.target.value)}),B.room_number&&e.jsx("p",{className:"text-sm text-red-500",children:B.room_number}),e.jsx(a,{type:"submit",disabled:Y,children:"Submit"})]})]})}),e.jsx(w,{open:L,onOpenChange:m,children:e.jsxs(v,{children:[e.jsx(q,{children:e.jsx(R,{children:"Edit Room"})}),e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[e.jsx(S,{placeholder:"e.g. 101",value:G.room_number,onChange:s=>z("room_number",s.target.value)}),E.room_number&&e.jsx("p",{className:"text-sm text-red-500",children:E.room_number}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(a,{type:"submit",disabled:V,children:"Update"})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(S,{placeholder:"Search rooms...",value:C,onChange:s=>Q(s.target.value),onKeyDown:te,className:"mb-4 w-full sm:w-1/3"}),e.jsx(a,{onClick:()=>x(!0),children:"Add Room"})]}),e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(M,{children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"Room Name"}),e.jsx(c,{children:"Room Code"}),e.jsx(c,{children:"QR Code"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(me,{children:l.data.map((s,t)=>{const n=typeof s.room_path=="string"?`${window.location.origin}/room/${s.room_path}`:null;return e.jsxs(M,{children:[e.jsx(d,{children:(l.current_page-1)*l.per_page+t+1}),e.jsxs(d,{children:["ROOM ",s.room_number]}),e.jsx(d,{children:s.room_path}),e.jsx(d,{children:n?e.jsx("div",{className:"w-16 h-16 bg-white p-1 rounded cursor-pointer m-1",onClick:g=>{g.stopPropagation(),re(n,s.room_number)},children:e.jsx(O,{value:n,size:64})}):e.jsx("span",{className:"text-sm text-gray-500",children:"No QR"})}),e.jsxs(d,{children:[e.jsx(a,{variant:"outline",size:"sm",onClick:()=>se(s),className:"mr-2",children:"Edit"}),e.jsx(a,{variant:"destructive",size:"sm",onClick:()=>oe(s.id),children:"Delete"})]})]},s.id)})})]}),e.jsxs("div",{className:"mt-2 flex flex-col sm:flex-row justify-between items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground m-2",children:["Page ",l.current_page," of ",l.last_page]}),e.jsx("div",{className:"flex flex-wrap justify-center items-center gap-2",children:l.links.map((s,t)=>{const n=s.label.replace("&laquo;","«").replace("&raquo;","»");return e.jsx(a,{variant:s.active?"default":"ghost",size:"sm",className:"min-w-[36px] px-3 py-1",onClick:()=>s.url&&b.visit(s.url),disabled:!s.url,dangerouslySetInnerHTML:{__html:n}},t)})})]})]}),e.jsx(w,{open:!!h,onOpenChange:()=>{N(""),y("")},children:e.jsxs(v,{className:"max-w-sm text-center",children:[e.jsxs(R,{children:["ROOM ",p]}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"inline-block p-4 bg-white rounded cursor-pointer",onClick:s=>{s.stopPropagation(),ne()},children:[e.jsx(O,{id:"qr-download",value:h,size:200}),e.jsx("p",{className:"text-xs mt-2 text-muted-foreground",children:"Click QR to copy link"})]}),$&&e.jsx("p",{className:"text-green-600 text-sm text-center mt-1",children:"Copied to clipboard!"}),e.jsx(a,{className:"mt-4",onClick:ae,children:"Download QR"})]})]})})]})]})]})}export{ke as default};
