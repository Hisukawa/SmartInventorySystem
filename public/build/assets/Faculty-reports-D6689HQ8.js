import{r as i,j as e,a as B}from"./app-DkGf-gG6.js";import{B as p}from"./button-C-Lh2kiR.js";import{C as Z,c as ee}from"./card-DtCmg6Zz.js";import{S as se,a as le,b as ae,c as te}from"./avatar-Cxo7W_4z.js";import{S as C}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{N as re}from"./Notification-B3MzxQqk.js";import{L}from"./label-Bf4TtUzS.js";import{D as q,a as H,b as M,c as U}from"./dialog-BUm42hAs.js";import{T as oe,a as ne,b as A,c as n,d as ie,e as t}from"./table-CG-mYlf1.js";import{B as ce,a as de,b as he,c as K,d as me}from"./breadcrumb-Be3_77Db.js";import{A as pe}from"./app-sidebar-B8j50-O2.js";import{I as X}from"./input-CJF7s6Fz.js";import{P as xe,a as ue,b as je}from"./popover-BIyrI9ef.js";import{S as b,a as v,b as g,c as y,d as r}from"./select-DTI7wDD8.js";import{C as fe}from"./circle-check-C0FDdoO3.js";import{T as be}from"./trash-2-Cecjz59E.js";import{F as ve}from"./funnel-Q7B-Hexq.js";import{X as Y}from"./index-D3EkHIGx.js";import"./index-D1I7Se4Z.js";import"./index-D66Z1uf-.js";import"./utils-LNzJWFRt.js";import"./index-Cn2OHilm.js";import"./dropdown-menu-DGOxBBxc.js";import"./index-CBtaYz-4.js";import"./chevron-right-D1Az-IMd.js";import"./index-DI9StidY.js";import"./index-BrI_I4bq.js";import"./bell-BnBfB9fC.js";import"./sparkles-CnWLDqDf.js";import"./keyboard-B-LgnOYd.js";import"./boxes-D2FMkA3x.js";import"./users-BwdY4FdZ.js";import"./chevron-down-DW-xq2fZ.js";import"./index-DpvvC_4f.js";function ge({filters:a,filterOptions:x,onApplyFilters:_,onResetFilters:S}){const[c,d]=i.useState(""),[f,h]=i.useState("");i.useEffect(()=>{a.condition?(d("condition"),h(a.condition)):a.room?(d("room"),h(a.room)):a.faculty?(d("faculty"),h(a.faculty)):a.reportable_type?(d("reportable_type"),h(a.reportable_type)):(d(""),h(""))},[a]);const j=l=>{const o=l==="all"?"":l;h(o);let N={...a};c&&(N[c]=o),_(N)},R=()=>{d(""),h(""),S()},F=[{value:"condition",label:"Condition"},{value:"room",label:"Room"},{value:"faculty",label:"Faculty"},{value:"reportable_type",label:"Report Type"}];return e.jsxs(xe,{children:[e.jsx(ue,{asChild:!0,children:e.jsxs(p,{className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",children:[e.jsx(ve,{className:"h-4 w-4"}),"Filter",(a.condition||a.room||a.faculty||a.reportable_type)&&e.jsx(Y,{className:"h-4 w-4 ml-1 cursor-pointer",onClick:l=>{l.stopPropagation(),l.preventDefault(),R()}})]})}),e.jsxs(je,{className:"w-[calc(100vw-2rem)] sm:w-[400px] p-4",children:[e.jsx("h4",{className:"font-medium mb-3 text-lg",children:"Filter Options"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(b,{value:c,onValueChange:l=>{d(l),h("")},children:[e.jsx(v,{className:"w-full",children:e.jsx(g,{placeholder:"Select Field"})}),e.jsx(y,{children:F.map(l=>e.jsx(r,{value:l.value,children:l.label},l.value))})]}),c==="condition"&&e.jsxs(b,{value:f||"all",onValueChange:j,children:[e.jsx(v,{className:"w-full",children:e.jsx(g,{placeholder:"Select Condition"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All"}),x.conditions.map((l,o)=>e.jsx(r,{value:l,children:l},o))]})]}),c==="room"&&e.jsxs(b,{value:f||"all",onValueChange:j,children:[e.jsx(v,{className:"w-full",children:e.jsx(g,{placeholder:"Select Room"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All"}),Object.entries(x.rooms).map(([l,o])=>e.jsxs(r,{value:l,children:["Room ",o]},l))]})]}),c==="faculty"&&e.jsxs(b,{value:f||"all",onValueChange:j,children:[e.jsx(v,{className:"w-full",children:e.jsx(g,{placeholder:"Select Faculty"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All"}),Object.entries(x.faculties).map(([l,o])=>e.jsx(r,{value:l,children:o},l))]})]}),c==="reportable_type"&&e.jsxs(b,{value:f||"all",onValueChange:j,children:[e.jsx(v,{className:"w-full",children:e.jsx(g,{placeholder:"Select Type"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All"}),x.reportable_types.map(l=>e.jsx(r,{value:l,children:l},l))]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(p,{size:"sm",variant:"outline",onClick:R,className:"w-auto px-3",children:[e.jsx(Y,{className:"mr-1 h-4 w-4"})," Reset"]})})]})]})]})}function ss({reports:a,filters:x={},filterOptions:_}){const[S,c]=i.useState(x.search||""),[d,f]=i.useState(null),[h,j]=i.useState(!1),R=s=>{f(s),j(!0)},[F,l]=i.useState(!1),[o,N]=i.useState(null),[k,P]=i.useState(""),[V,T]=i.useState(""),G=s=>{N(s),P(s.condition),T(""),l(!0)},J=s=>{if(!k){C.fire({icon:"warning",title:"Select Condition",text:"Please select a new condition before resolving."});return}s&&B.post(`/admin/faculty-reports/${s.id}/resolve`,{report_id:s.id,old_condition:s.condition,new_condition:k,details:V},{onSuccess:()=>{l(!1),N(null),P(""),T(""),C.fire({icon:"success",title:"Resolved!",text:`Report #${s.id} has been successfully resolved.`,timer:2e3,showConfirmButton:!1})},onError:m=>{C.fire({icon:"error",title:"Error",text:"Failed to resolve report. Please try again."}),console.log(m)}})},[u,D]=i.useState(1),w=10,O=Math.ceil(a.length/w),z=a.slice((u-1)*w,u*w);function E(s){const m=Object.fromEntries(Object.entries(s).filter(([I,$])=>$!==""&&$!==void 0));B.get(route("admin.reports.index"),{...m,search:S||void 0})}function Q(){c(""),B.get(route("admin.reports.index"))}function W(s){s.key==="Enter"&&E(x)}return e.jsxs(se,{children:[e.jsx(pe,{}),e.jsxs(le,{children:[e.jsx("header",{className:"sticky top-0 z-20 bg-white border-b px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{}),e.jsx(te,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(ce,{children:e.jsx(de,{children:e.jsxs(he,{children:[e.jsx(K,{href:"#","aria-current":"page",children:"Reports"}),e.jsx(me,{}),e.jsx(K,{href:"/admin/faculty/reports","aria-current":"page",className:"font-semibold text-foreground",children:"Faculty Reports"})]})})}),e.jsx("div",{className:"flex-1"}),e.jsx(re,{})]})}),e.jsx("main",{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-5",children:"Faculty Reports"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[e.jsx(ge,{filters:x,filterOptions:_,onApplyFilters:E,onResetFilters:Q}),e.jsx(X,{placeholder:"Search reports...",value:S,onChange:s=>c(s.target.value),onKeyDown:W,className:`flex-1 min-w-0 sm:max-w-xs w-full
             border-[hsl(142,34%,51%)] text-[hsl(142,34%,20%)]
             focus:border-[hsl(142,34%,45%)] focus:ring-[hsl(142,34%,45%)]
             placeholder:text-[hsl(142,34%,40%)]`})]}),e.jsx(Z,{children:e.jsxs(ee,{className:"p-0",children:[e.jsxs(oe,{children:[e.jsx(ne,{children:e.jsxs(A,{className:"bg-[hsl(142,34%,85%)] text-[hsl(142,34%,25%)] hover:bg-[hsl(142,34%,80%)]",children:[e.jsx(n,{children:"#"}),e.jsx(n,{children:"Faculty"}),e.jsx(n,{children:"Room"}),e.jsx(n,{children:"Reports Type"}),e.jsx(n,{children:"Reports ID"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Code"}),e.jsx(n,{children:"Condition"}),e.jsx(n,{children:"Remarks"}),e.jsx(n,{children:"Photo"}),e.jsx(n,{children:"Date Reported"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(ie,{children:z.length>0?z.map((s,m)=>e.jsxs(A,{children:[e.jsx(t,{children:(u-1)*w+m+1}),e.jsx(t,{children:s.user?.name||"N/A"}),e.jsxs(t,{children:["ROOM"," ",s.room?s.room.room_number:"N/A"]}),e.jsx(t,{children:s.reportable_type}),e.jsx(t,{children:s.reportable_id}),e.jsx(t,{children:s.reportable_type==="peripheral"?s.reportable?.type:s.reportable_type==="system_unit"?"System Unit":s.reportable_type==="equipment"?s.reportable?.equipment_type:"N/A"}),e.jsx(t,{children:s.reportable_type==="peripheral"?s.reportable?.peripheral_code:s.reportable_type==="system_unit"?s.reportable?.unit_code:s.reportable_type==="equipment"?s.reportable?.equipment_code:"N/A"}),e.jsx(t,{children:s.condition}),e.jsx(t,{children:s.remarks}),e.jsx(t,{children:s.photo_path?e.jsx("img",{src:`/storage/${s.photo_path}`,alt:"Report",className:"w-16 h-16 object-cover rounded cursor-pointer hover:shadow-lg",onClick:()=>R(s.photo_path)}):"No photo"}),e.jsx(t,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(t,{children:e.jsxs("div",{className:"flex gap-2",children:[s.status!=="resolved"?e.jsxs(p,{size:"sm",variant:"secondary",className:"flex items-center gap-2",onClick:()=>G(s),children:[e.jsx(fe,{className:"w-4 h-4"}),"Resolve"]}):e.jsx("span",{className:"text-green-600 font-medium",children:"Resolved"}),e.jsxs(p,{size:"sm",variant:"destructive",className:"flex items-center gap-2",onClick:()=>{C.fire({title:`Delete report #${s.id}?`,text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"}).then(I=>{I.isConfirmed&&(handleDelete(s.id),C.fire("Deleted!",`Report #${s.id} has been deleted.`,"success"))})},children:[e.jsx(be,{className:"h-4 w-4"}),"Delete"]})]})})]},s.id)):e.jsx(A,{children:e.jsx(t,{colSpan:"11",className:"text-center",children:"No reports found."})})})]}),e.jsxs("div",{className:"flex justify-center mt-4 space-x-2",children:[e.jsx(p,{variant:"outline",size:"sm",disabled:u===1,onClick:()=>D(u-1),children:"Previous"}),[...Array(O)].map((s,m)=>e.jsx(p,{variant:u===m+1?"default":"outline",size:"sm",onClick:()=>D(m+1),children:m+1},m)),e.jsx(p,{variant:"outline",size:"sm",disabled:u===O,onClick:()=>D(u+1),children:"Next"})]})]})})]})}),e.jsx(q,{open:h,onOpenChange:j,children:e.jsxs(H,{className:"flex flex-col items-center",children:[e.jsx(M,{children:e.jsx(U,{children:"Report Photo"})}),d&&e.jsx("img",{src:`/storage/${d}`,alt:"Report",className:"max-w-full max-h-[80vh] object-contain rounded"})]})}),e.jsx(q,{open:F,onOpenChange:l,children:e.jsxs(H,{className:"max-w-md w-full",children:[e.jsx(M,{children:e.jsxs(U,{children:["Resolve Report #",o?.id]})}),e.jsxs("div",{className:"flex flex-col gap-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(L,{children:"Condition"}),e.jsxs(b,{value:k||o?.condition,onValueChange:P,children:[e.jsx(v,{children:e.jsx(g,{placeholder:"Select Condition"})}),e.jsxs(y,{children:[e.jsx(r,{value:"Functional",children:"Functional"}),e.jsx(r,{value:"Needs Repair",children:"Needs Repair"}),e.jsx(r,{value:"Replaced",children:"Replaced"}),e.jsx(r,{value:"Not Repairable",children:"Not Repairable"})]})]})]}),e.jsxs("div",{children:[e.jsx(L,{children:"Resolution Details"}),e.jsx(X,{type:"text",placeholder:"Describe how you fixed it...",value:V,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx(p,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(p,{onClick:()=>J(o),variant:"secondary",children:"Save"})]})]})]})})]})]})}export{ss as default};
