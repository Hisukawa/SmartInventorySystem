import{r as m,j as e,L as E,R as ce,a as H}from"./app-BIwlyt8C.js";import{B as n}from"./button-Cvjh1GZ1.js";import"./card-C0RzOCM5.js";import{S as me,a as he,b as xe,c as pe}from"./avatar-C4XO60we.js";import"./sweetalert2.esm.all-BQIkj5Wb.js";import{N as ue}from"./Notification-DKVJWeTh.js";import{S as ge,J as je,R as be,F as fe}from"./server.browser-x93LCpRi.js";import{C as q}from"./checkbox-Ds7aHkjT.js";import{Q as Ne}from"./index-BHqbGeDj.js";import{T as ve,a as we,b as D,c as b,d as ye,e as p}from"./table-DwQ2yeli.js";import{B as Se,a as Ce,b as _e,c as W,d as Pe}from"./breadcrumb-Dq-G1BxX.js";import{A as Re}from"./app-sidebar-D3sVUVD4.js";import{I as ke}from"./input-DuJpVvIv.js";import Ae from"./EditPeripheralModal-CXBOgEk0.js";import{P as $e,a as Te,b as ze}from"./popover-uK11uE3a.js";import{S as v,a as w,b as y,c as S,d as i}from"./select-Cn-9VPP9.js";import{P as Ie}from"./printer-CX5p0_fq.js";import{c as Be}from"./createLucideIcon-B8B2iXso.js";import{E as J}from"./eye-FRpkXrUi.js";import{P as G}from"./pen-UmBT7AwN.js";import{l as P,E as Ee}from"./menu-CWsvvpZy.js";import{F as De}from"./funnel-CTLZA15S.js";import{X as Le}from"./index-DeiY3fR0.js";import"./index-CIhkfTGN.js";import"./utils-CBfrqCZ4.js";import"./index-_GrsYgzc.js";import"./index-CROv15xz.js";import"./dropdown-menu-COXCHGXD.js";import"./index-PtQ2pING.js";import"./chevron-right-CPQRjjEL.js";import"./index-ZmtpnWyZ.js";import"./index-CC1TizNa.js";import"./bell-FiFxLgBB.js";import"./index-CXcRdS9j.js";import"./house-Ch_sl3RI.js";import"./user-B5GN24-g.js";import"./log-out-BsUZLdLy.js";import"./keyboard-DMtpdZmG.js";import"./boxes-CK2rTsmI.js";import"./users-CNhX2TRz.js";import"./chevron-down-CBOqi84k.js";import"./dialog-C_6Sayg6.js";import"./label-Cd8jull_.js";import"./textarea-CI6_-Cnz.js";import"./portal-CG5L1WZv.js";import"./with-selector-FEtfw_px.js";/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Oe=Be("download",Me);function Ve({filters:a,filterOptions:u,onApplyFilters:d}){const[c,h]=m.useState(""),R=()=>{const r={type:void 0,condition:void 0,room_id:void 0,unit_code:void 0};h(""),d(r)};return e.jsxs($e,{children:[e.jsx(Te,{asChild:!0,children:e.jsxs(n,{size:"sm",className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Filters"]})}),e.jsx(ze,{className:"w-72",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(v,{value:c,onValueChange:h,children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Select filter field"})}),e.jsxs(S,{children:[e.jsx(i,{value:"type",children:"Type"}),e.jsx(i,{value:"condition",children:"Condition"}),e.jsx(i,{value:"room",children:"Room"}),e.jsx(i,{value:"unit",children:"Unit"})]})]}),c==="type"&&e.jsxs(v,{value:a.type||"all",onValueChange:r=>d({...a,type:r==="all"?void 0:r}),children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Select Type"})}),e.jsxs(S,{children:[e.jsx(i,{value:"all",children:"All"}),u.types.map(r=>e.jsx(i,{value:r,children:r},r))]})]}),c==="condition"&&e.jsxs(v,{value:a.condition||"all",onValueChange:r=>d({...a,condition:r==="all"?void 0:r}),children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Select Condition"})}),e.jsxs(S,{children:[e.jsx(i,{value:"all",children:"All"}),u.conditions.map(r=>e.jsx(i,{value:r,children:r},r))]})]}),c==="room"&&e.jsxs(v,{value:a.room_id||"all",onValueChange:r=>d({...a,room_id:r==="all"?void 0:r,unit_id:void 0}),children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Select Room"})}),e.jsxs(S,{children:[e.jsx(i,{value:"all",children:"All"}),Object.entries(u.rooms).map(([r,x])=>e.jsxs(i,{value:r,children:["Room ",x]},r))]})]}),c==="unit"&&e.jsxs(v,{value:a.unit_id||"all",onValueChange:r=>d({...a,unit_id:r==="all"?void 0:r}),children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Select Unit"})}),e.jsxs(S,{children:[e.jsx(i,{value:"all",children:"All"}),u.units.length===0&&e.jsx("div",{className:"px-3 py-2 text-sm text-gray-400",children:"No units found for this room"}),u.units.map(r=>e.jsx(i,{value:r.id,children:r.code},r.id))]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(n,{size:"sm",variant:"outline",onClick:R,className:"flex items-center gap-1",children:[e.jsx(Le,{className:"h-4 w-4"}),"Reset All"]})})]})})]})}function Et({peripherals:a,search:u,existingRooms:d,existingUnits:c,filters:h={}}){const[R,r]=m.useState(!1),[x,K]=m.useState(null),[A,k]=m.useState([]),[$,L]=m.useState(!1),X=t=>{K(t),a.filter(l=>l.room_id===t).map(l=>l.id),k([]),L(!1)},Z=()=>{if($)k([]);else if(x){const t=a.filter(l=>l.room_id===x).map(l=>l.id);k(t)}L(!$)},Y=t=>{k(l=>l.includes(t)?l.filter(s=>s!==t):[...l,t])},ee=async()=>{if(A.length===0){alert("Select at least one peripheral.");return}const t=a.filter(s=>A.includes(s.id)),l=new je;for(const s of t){const B=`${window.location.origin}/peripherals/${s.peripheral_code}`,ie=be.renderToString(e.jsx(Ne,{value:B,size:256})),ne=new Blob([ie],{type:"image/svg+xml"}),Q=URL.createObjectURL(ne),N=new Image;await new Promise(oe=>{N.onload=()=>{const g=document.createElement("canvas");g.width=N.width+40,g.height=N.height+40+50;const j=g.getContext("2d");j.fillStyle="#fff",j.fillRect(0,0,g.width,g.height),j.drawImage(N,20,20),j.fillStyle="#000",j.font="bold 18px Arial",j.textAlign="center",j.fillText(`Room ${s.room?.room_number} - ${s.peripheral_code}`,g.width/2,N.height+20+30),g.toBlob(de=>{l.file(`${s.peripheral_code}.png`,de),oe()},"image/png")},N.src=Q}),URL.revokeObjectURL(Q)}l.generateAsync({type:"blob"}).then(s=>{fe.saveAs(s,"QR_Codes.zip")})},[C,M]=m.useState(u||""),[O,T]=m.useState(null),[o,z]=m.useState(1),f=10,te=m.useMemo(()=>{const t=s=>[...new Set(s.filter(B=>B))].sort(),l=h.room_id?c.filter(s=>String(s.room_id)===String(h.room_id)):c;return{types:t(a.map(s=>s.type)),conditions:t(a.map(s=>s.condition)),rooms:Object.fromEntries(d.map(s=>[String(s.id),s.room_number])),units:l.map(s=>({id:String(s.id),code:s.unit_code}))}},[a,d,c,h.room_id]);function V(t){const l=Object.fromEntries(Object.entries({...t,search:C||void 0}).filter(([,s])=>s!==""&&s!==void 0));H.get("/admin/peripherals",l,{preserveState:!0,replace:!0})}function se(){M(""),H.get("/admin/peripherals",{},{preserveState:!0,replace:!0})}const le=t=>{t.key==="Enter"&&V(h)},_=m.useMemo(()=>{if(!C)return a;const t=C.toLowerCase();return a.filter(l=>[l.peripheral_code,l.type,l.serial_number,l.condition,l.room?.room_number,l.unit_code].filter(Boolean).some(s=>s.toLowerCase().includes(t)))},[a,C]),I=Math.ceil(_.length/f)||1,F=_.slice((o-1)*f,o*f),re=()=>{if(!a||a.length===0){alert("No data available to print.");return}const t=window.open("","","width=900,height=700"),l=a.map(s=>`
        <tr>
            <td>${s.id}</td>
            <td>${s.peripheral_code}</td>
            <td>${s.type}</td>
            <td>${s.brand??"N/A"}</td>
            <td>${s.model??"N/A"}</td>
            <td>${s.serial_number??"N/A"}</td>
            <td>${s.condition??"N/A"}</td>
            <td>${s.room?.room_number??"N/A"}</td>
            <td>${s.unit?.unit_code??"N/A"}</td>
            <td>${s.unit?.mr_to?.name??"N/A"}</td>
        </tr>
    `).join("");t.document.write(`
        <html>
            <head>
                <title>Complete Peripherals Report</title>
                <style>
                    body {
                        font-family: Arial, sans-serif;
                        padding: 20px;
                    }
                    h2 {
                        text-align: center;
                        margin-bottom: 20px;
                        color: #2e7d32;
                    }
                    p {
                        text-align: right;
                        font-size: 12px;
                        color: #666;
                    }
                    table {
                        width: 100%;
                        border-collapse: collapse;
                        margin-top: 10px;
                    }
                    th, td {
                        border: 1px solid #ccc;
                        padding: 8px;
                        text-align: left;
                        font-size: 13px;
                    }
                    th {
                        background-color: #2e7d32;
                        color: white;
                    }
                    tr:nth-child(even) {
                        background-color: #f9f9f9;
                    }
                    @media print {
                        body { -webkit-print-color-adjust: exact; }
                    }
                </style>
            </head>
            <body>
                <h2>Complete Peripherals Report</h2>
                <p>Generated on: ${new Date().toLocaleString()}</p>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Peripheral Code</th>
                            <th>Type</th>
                            <th>Brand</th>
                            <th>Model</th>
                            <th>Serial Number</th>
                            <th>Condition</th>
                            <th>Room</th>
                            <th>Unit Code</th>
                            <th>Material Responsible</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${l}
                    </tbody>
                </table>
            </body>
        </html>
    `),t.document.close(),t.print()},ae={Working:"bg-green-200 text-green-800","Not Working":"bg-red-200 text-red-800","Intermittent Issue":"bg-yellow-200 text-yellow-800","Needs Cleaning":"bg-blue-200 text-blue-800","For Replacement":"bg-orange-200 text-orange-800","For Disposal":"bg-gray-200 text-gray-800",Condemned:"bg-black text-white","Needs Repair":"bg-red-200 text-red-800","No Signal":"bg-red-200 text-red-800","Needs Configuration":"bg-blue-200 text-blue-800","Under Maintenance":"bg-blue-200 text-blue-900","To Be Diagnosed":"bg-blue-100 text-blue-700"};function U(t){if(!t)return{label:"N/A",color:"bg-slate-400 text-white"};const l=ae[t]||"bg-slate-400 text-white";return{label:t,color:l}}return e.jsxs(me,{children:[e.jsx(Re,{}),e.jsxs(he,{children:[e.jsx("header",{className:"sticky top-0 z-20 bg-white border-b px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{}),e.jsx(pe,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(Se,{children:e.jsx(Ce,{children:e.jsxs(_e,{children:[e.jsx(W,{href:"#","aria-current":"page",children:"Assets"}),e.jsx(Pe,{}),e.jsx(W,{href:"/admin/peripherals","aria-current":"page",className:"font-semibold text-foreground",children:"Peripherals"})]})})}),e.jsx("div",{className:"flex-1"}),e.jsx(ue,{})]})}),e.jsxs("main",{children:[e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-5",children:"Peripherals"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch sm:items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex gap-2 items-center flex-1",children:[e.jsx(ke,{placeholder:"Search peripherals...",value:C,onChange:t=>M(t.target.value),onKeyDown:le,className:"flex-1 min-w-0 sm:max-w-xs w-full border-[hsl(142,34%,51%)]"}),e.jsx(Ve,{filters:h,filterOptions:te,onApplyFilters:V,onReset:se}),e.jsxs(n,{className:"flex items-center gap-2 bg-[hsl(183,40%,45%)] text-white border-none hover:bg-[hsl(183,40%,38%)]",onClick:re,children:[e.jsx(Ie,{className:"h-4 w-4"}),"Print"]}),e.jsxs(n,{className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white",onClick:()=>r(!0),children:[e.jsx(Oe,{className:"h-4 w-4"}),"Download QR Codes"]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(E,{href:"/admin/peripherals/create",children:e.jsx(n,{className:"bg-[hsl(142,31%,51%)] hover:bg-[hsl(142,31%,45%)] text-white font-medium",children:"Add Peripheral"})})})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg shadow-lg",children:e.jsxs(ve,{className:"w-full table-auto",children:[e.jsx(we,{children:e.jsxs(D,{className:"bg-[hsl(142,34%,85%)] text-[hsl(142,34%,25%)] hover:bg-[hsl(142,34%,80%)] h-10 text-center",children:[e.jsx(b,{className:"px-5 py-1 text-center",children:"#"}),e.jsx(b,{className:"px-5 py-1 text-center",children:"Peripheral Code"}),e.jsx(b,{className:"px-5 py-1 text-center",children:"Type"}),e.jsx(b,{className:"px-5 py-1 text-center",children:"Room"}),e.jsx(b,{className:"px-5 py-1 text-center",children:"Units"}),e.jsx(b,{className:"px-5 py-1 text-center",children:"Condition"}),e.jsx(b,{className:"px-5 py-1 text-center",children:"Actions"})]})}),e.jsx(ye,{children:F.length>0?F.map((t,l)=>e.jsxs(D,{className:"hover:shadow-sm text-center",children:[e.jsx(p,{className:"px-5 py-2 align-middle",children:(o-1)*f+l+1}),e.jsx(p,{className:"px-5 py-2 align-middle",children:t.peripheral_code}),e.jsx(p,{className:"px-5 py-2 align-middle",children:t.type}),e.jsx(p,{className:"px-5 py-2 align-middle",children:t.room?`ROOM ${t.room.room_number}`:"N/A"}),e.jsx(p,{className:"px-5 py-2 align-middle",children:t.unit?t.unit.unit_code:"N/A"}),e.jsx(p,{className:"px-5 py-2 align-middle",children:t.condition?e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${U(t.condition).color}`,children:U(t.condition).label}):"N/A"}),e.jsxs(p,{className:"px-5 py-2 align-middle",children:[e.jsxs("div",{className:"hidden sm:flex justify-center items-center gap-2",children:[e.jsx(E,{href:`/admin/peripherals/${t.id}`,children:e.jsxs(n,{size:"sm",className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",children:[e.jsx(J,{className:"h-4 w-4"})," ","View"]})}),e.jsxs(n,{size:"sm",className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",onClick:()=>T(t),children:[e.jsx(G,{className:"h-4 w-4"})," ","Edit"]})]}),e.jsx("div",{className:"sm:hidden flex justify-center",children:e.jsxs(P,{as:"div",className:"relative inline-block text-left",children:[e.jsx(P.Button,{className:"p-2 rounded bg-[hsl(142,34%,51%)] text-white",children:e.jsx(Ee,{className:"h-5 w-5"})}),e.jsx(P.Items,{className:"absolute right-0 mt-2 w-28 origin-top-right bg-white border border-gray-200 divide-y divide-gray-100 rounded-md shadow-lg focus:outline-none z-50",children:e.jsxs("div",{className:"px-1 py-1",children:[e.jsx(P.Item,{children:({active:s})=>e.jsxs(E,{href:`/admin/peripherals/${t.id}`,className:`${s?"bg-[hsl(142,34%,90%)]":""} group flex w-full items-center rounded-md px-2 py-2 text-sm text-gray-700`,children:[e.jsx(J,{className:"h-4 w-4 mr-2"})," ","View"]})}),e.jsx(P.Item,{children:({active:s})=>e.jsxs("button",{className:`${s?"bg-[hsl(142,34%,90%)]":""} group flex w-full items-center rounded-md px-2 py-2 text-sm text-gray-700`,onClick:()=>T(t),children:[e.jsx(G,{className:"h-4 w-4 mr-2"})," ","Edit"]})})]})})]})})]})]},t.id)):e.jsx(D,{children:e.jsx(p,{colSpan:8,className:"text-center py-4",children:"No peripherals found."})})})]})}),e.jsxs("div",{className:"flex justify-between items-center p-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing"," ",_.length===0?0:(o-1)*f+1," ","–",Math.min(o*f,_.length)," ","of ",_.length," peripherals"," "]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",disabled:o===1,onClick:()=>z(o-1),children:"Previous"}),Array.from({length:I},(t,l)=>l+1).filter(t=>t===1||t===I?!0:t>=o-2&&t<=o+2).map((t,l,s)=>e.jsxs(ce.Fragment,{children:[l>0&&s[l]-s[l-1]>1&&e.jsx("span",{className:"px-2",children:"..."}),e.jsx(n,{size:"sm",variant:o===t?"default":"outline",onClick:()=>z(t),children:t})]},t)),e.jsx(n,{size:"sm",variant:"outline",disabled:o===I,onClick:()=>z(o+1),children:"Next"})]})]})]}),e.jsxs("div",{className:`fixed top-0 right-0 h-full w-96 bg-white shadow-xl transform transition-transform duration-300 z-50 flex flex-col
  ${R?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Download QR Codes by Room"}),e.jsx(n,{variant:"ghost",onClick:()=>r(!1),children:"✕"})]}),e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("label",{className:"block mb-2 font-medium text-sm text-gray-700",children:"Select Room"}),e.jsxs(v,{value:x||"",onValueChange:t=>X(Number(t)),children:[e.jsx(w,{className:"w-full",children:e.jsx(y,{placeholder:"-- Select Room --"})}),e.jsx(S,{children:d.map(t=>e.jsx(i,{value:t.id.toString(),children:t.room_number},t.id))})]})]}),x&&e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b",children:[e.jsx(q,{checked:$,onCheckedChange:Z}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Select All Peripherals in Room"})]}),x&&e.jsx(ge,{className:"flex-1 overflow-y-auto p-4 space-y-2",children:a.filter(t=>t.room_id===x).map(t=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-md hover:bg-gray-50 transition",children:[e.jsx(q,{checked:A.includes(t.id),onCheckedChange:()=>Y(t.id)}),e.jsxs("span",{className:"text-sm text-gray-800",children:[t.type," - ",t.peripheral_code]})]},t.id))}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[e.jsx(n,{variant:"secondary",onClick:()=>r(!1),children:"Close"}),e.jsx(n,{className:"bg-[hsl(142,34%,51%)] text-white hover:bg-[hsl(142,34%,45%)]",onClick:ee,children:"Download Selected"})]})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:()=>r(!1)})]}),O&&e.jsx(Ae,{peripheral:O,rooms:d,units:c,onClose:()=>T(null)})]})]})}export{Et as default};
