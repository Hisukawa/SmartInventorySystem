import{r as o,j as t,c as l}from"./app-YUBFmmkD.js";import{B as u}from"./bell-DdP6RJhv.js";function w(){const[s,n]=o.useState([]),[c,d]=o.useState(!1),i=o.useRef(null);o.useEffect(()=>{const e=async()=>{try{const r=await l.get("/notifications");n(r.data)}catch(r){console.error("Failed to fetch notifications:",r)}};e();const a=setInterval(e,5e3);return()=>clearInterval(a)},[]),o.useEffect(()=>{const e=a=>{i.current&&!i.current.contains(a.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const m=async e=>{try{await l.patch(`/notifications/${e}/read`),n(a=>a.filter(r=>r.id!==e))}catch(a){console.error("Failed to mark notification as read",a)}},x=async()=>{try{await l.patch("/notifications/mark-all-read"),n([])}catch(e){console.error("Failed to mark all notifications as read",e)}},h=(e,a)=>{e.stopPropagation(),m(a.id),a.data.report_id?window.location.href=`/admin/faculty/reports/${a.data.report_id}`:window.location.href="/admin/faculty/reports"};return t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>d(!c),className:"relative p-2 rounded-full hover:bg-gray-100",children:[t.jsx(u,{className:"w-6 h-6 text-gray-700"}),s.length>0&&t.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs px-1 rounded-full",children:s.length})]}),c&&t.jsxs("div",{ref:i,className:"absolute right-0 mt-2 w-80 sm:w-96 max-w-[95vw] sm:max-w-sm bg-white shadow-lg rounded-lg overflow-hidden z-50",children:[t.jsxs("div",{className:"p-3 border-b font-semibold flex justify-between items-center",children:[t.jsx("span",{children:"Notifications"}),s.length>0&&t.jsx("button",{onClick:x,className:"text-xs text-blue-600 hover:underline",children:"Mark all as read"})]}),t.jsx("ul",{className:"max-h-64 overflow-y-auto",children:s.length>0?s.map(e=>t.jsxs("li",{onClick:a=>h(a,e),className:"px-4 py-2 hover:bg-gray-50 cursor-pointer border-b",children:[t.jsx("p",{className:"text-sm font-bold",children:e.data.user_name}),t.jsxs("p",{className:"text-sm",children:["Condition: ",e.data.condition]}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Room Number: ",e.data.room_number]}),t.jsx("p",{className:"text-xs",children:e.data.remarks})]},e.id)):t.jsx("li",{className:"p-4 text-gray-500 text-sm",children:"No notifications"})}),t.jsx("div",{className:"p-2 text-center border-t",children:t.jsx("a",{href:"/admin/faculty/reports",className:"text-sm text-blue-600 hover:underline",children:"View all"})})]})]})}export{w as N};
