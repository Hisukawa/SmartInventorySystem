import{r,j as e,t as B,a as O}from"./app-BTeY5w86.js";import{B as u}from"./button-CkuxFOnS.js";import{C as te,a as re}from"./card-CnYnJmMf.js";import{S as oe,a as ne,b as ie,c as ce}from"./avatar-CczYL18j.js";import"./sweetalert2.esm.all-BQIkj5Wb.js";import{N as de}from"./Notification-Bo8scV7f.js";import{L as I}from"./label-BPK-s6rL.js";import{D as $,a as K,b as X,c as G}from"./dialog-BMKxGqXU.js";import{T as he,a as me,b as E,c as n,d as xe,e as t}from"./table-hIQhzdoT.js";import{B as pe,a as ue,b as je,c as J,d as be}from"./breadcrumb-Dr30YftT.js";import{A as ve}from"./app-sidebar-Dih0oAYx.js";import{I as Q}from"./input-CH6dE5v8.js";import{P as fe,a as ge,b as ye}from"./popover-DSk7kfoE.js";import{S as y,a as N,b as R,c as S,d as o}from"./select-BkRnD1Yf.js";import{C as W}from"./circle-check-PpjGI2hW.js";import{F as Ne}from"./funnel-CnJndvwh.js";import{X as Y}from"./index-BjsvSQbE.js";import"./index-VWAVIAMN.js";import"./utils-CBfrqCZ4.js";import"./createLucideIcon-D803OLAH.js";import"./index-DUNPNiKJ.js";import"./index-BBzxCWiv.js";import"./dropdown-menu-KpcpNISd.js";import"./index-CXHEpsGH.js";import"./chevron-right-LCvQ70nC.js";import"./index-CzTVvlmh.js";import"./index-DBXy2o1c.js";import"./bell-C_aaVydL.js";import"./user-BOhQoxru.js";import"./keyboard-C22QZwZP.js";import"./boxes-BwhybTu8.js";import"./users-BYwRrReq.js";import"./chevron-down-CFSRaM9f.js";import"./index-VK6kJDY3.js";function Re({filters:a,filterOptions:p,onApplyFilters:P,onResetFilters:j}){const[x,c]=r.useState(""),[b,i]=r.useState("");r.useEffect(()=>{a.condition?(c("condition"),i(a.condition)):a.room?(c("room"),i(a.room)):a.faculty?(c("faculty"),i(a.faculty)):a.reportable_type?(c("reportable_type"),i(a.reportable_type)):(c(""),i(""))},[a]);const f=l=>{const d=l==="all"?"":l;i(d);let v={...a};x&&(v[x]=d),P(v)},w=()=>{c(""),i(""),j()},_=[{value:"condition",label:"Condition"},{value:"room",label:"Room"},{value:"faculty",label:"Faculty"},{value:"reportable_type",label:"Report Type"}];return e.jsxs(fe,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(u,{className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Filter",(a.condition||a.room||a.faculty||a.reportable_type)&&e.jsx(Y,{className:"h-4 w-4 ml-1 cursor-pointer",onClick:l=>{l.stopPropagation(),l.preventDefault(),w()}})]})}),e.jsxs(ye,{className:"w-[calc(100vw-2rem)] sm:w-[400px] p-4",children:[e.jsx("h4",{className:"font-medium mb-3 text-lg",children:"Filter Options"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(y,{value:x,onValueChange:l=>{c(l),i("")},children:[e.jsx(N,{className:"w-full",children:e.jsx(R,{placeholder:"Select Field"})}),e.jsx(S,{children:_.map(l=>e.jsx(o,{value:l.value,children:l.label},l.value))})]}),x==="condition"&&e.jsxs(y,{value:b||"all",onValueChange:f,children:[e.jsx(N,{className:"w-full",children:e.jsx(R,{placeholder:"Select Condition"})}),e.jsxs(S,{children:[e.jsx(o,{value:"all",children:"All"}),p.conditions.map((l,d)=>e.jsx(o,{value:l,children:l},d))]})]}),x==="room"&&e.jsxs(y,{value:b||"all",onValueChange:f,children:[e.jsx(N,{className:"w-full",children:e.jsx(R,{placeholder:"Select Room"})}),e.jsxs(S,{children:[e.jsx(o,{value:"all",children:"All"}),Object.entries(p.rooms).map(([l,d])=>e.jsxs(o,{value:l,children:["Room ",d]},l))]})]}),x==="faculty"&&e.jsxs(y,{value:b||"all",onValueChange:f,children:[e.jsx(N,{className:"w-full",children:e.jsx(R,{placeholder:"Select Faculty"})}),e.jsxs(S,{children:[e.jsx(o,{value:"all",children:"All"}),Object.entries(p.faculties).map(([l,d])=>e.jsx(o,{value:l,children:d},l))]})]}),x==="reportable_type"&&e.jsxs(y,{value:b||"all",onValueChange:f,children:[e.jsx(N,{className:"w-full",children:e.jsx(R,{placeholder:"Select Type"})}),e.jsxs(S,{children:[e.jsx(o,{value:"all",children:"All"}),p.reportable_types.map(l=>e.jsx(o,{value:l,children:l},l))]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(u,{size:"sm",variant:"outline",onClick:w,className:"w-auto px-3",children:[e.jsx(Y,{className:"mr-1 h-4 w-4"})," Reset"]})})]})]})]})}function ts({reports:a,filters:p={},filterOptions:P}){const[j,x]=r.useState(a),[c,b]=r.useState(p.search||""),[i,f]=r.useState(null),[w,_]=r.useState(!1),l=s=>{f(s),_(!0)},[d,v]=r.useState(!1),[C,z]=r.useState(a),[F,D]=r.useState(""),[L,T]=r.useState(""),[A,Z]=r.useState(!1),ee=s=>{z(s),D(s.condition),T(""),v(!0)},se=s=>{if(!F){B.warning("Select Condition",{description:"Please select a new condition before resolving.",duration:2500});return}Z(!0),O.post(`/admin/faculty-reports/${s.id}/resolve`,{report_id:s.id,old_condition:s.condition,new_condition:F,details:L},{onSuccess:()=>{v(!1),z(null),D(""),T(""),B.success("Resolved!",{description:`Report #${s.id} has been successfully resolved.`,duration:2e3}),x(m=>m.map(k=>k.id===s.id?{...k,resolved:!0,condition:F}:k))},onError:()=>{B.error("Error",{description:"Failed to resolve report. Please try again.",duration:2500})}})},[h,V]=r.useState(1),g=10,q=Math.ceil(j.length/g),H=j.slice((h-1)*g,h*g);function M(s){const m=Object.fromEntries(Object.entries(s).filter(([k,U])=>U!==""&&U!==void 0));O.get(route("admin.reports.index"),{...m,search:c||void 0})}function le(){b(""),O.get(route("admin.reports.index"))}function ae(s){s.key==="Enter"&&M(p)}return e.jsxs(oe,{children:[e.jsx(ve,{}),e.jsxs(ne,{children:[e.jsx("header",{className:"sticky top-0 z-20 bg-white border-b px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{}),e.jsx(ce,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(pe,{children:e.jsx(ue,{children:e.jsxs(je,{children:[e.jsx(J,{href:"#","aria-current":"page",children:"Reports"}),e.jsx(be,{}),e.jsx(J,{href:"/admin/faculty/reports","aria-current":"page",className:"font-semibold text-foreground",children:"Faculty Reports"})]})})}),e.jsx("div",{className:"flex-1"}),e.jsx(de,{})]})}),e.jsx("main",{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-5",children:"Faculty Reports"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[e.jsx(Re,{filters:p,filterOptions:P,onApplyFilters:M,onResetFilters:le}),e.jsx(Q,{placeholder:"Search reports...",value:c,onChange:s=>b(s.target.value),onKeyDown:ae,className:`flex-1 min-w-0 sm:max-w-xs w-full
             border-[hsl(142,34%,51%)] text-[hsl(142,34%,20%)]
             focus:border-[hsl(142,34%,45%)] focus:ring-[hsl(142,34%,45%)]
             placeholder:text-[hsl(142,34%,40%)]`})]}),e.jsx(te,{children:e.jsxs(re,{className:"p-0",children:[e.jsxs(he,{children:[e.jsx(me,{children:e.jsxs(E,{className:"bg-[hsl(142,34%,85%)] text-[hsl(142,34%,25%)] hover:bg-[hsl(142,34%,80%)]",children:[e.jsx(n,{children:"#"}),e.jsx(n,{children:"Faculty"}),e.jsx(n,{children:"Room"}),e.jsx(n,{children:"Reports Type"}),e.jsx(n,{children:"Reports ID"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Code"}),e.jsx(n,{children:"Condition"}),e.jsx(n,{children:"Remarks"}),e.jsx(n,{children:"Photo"}),e.jsx(n,{children:"Date Reported"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(xe,{children:H.length>0?H.map((s,m)=>e.jsxs(E,{children:[e.jsx(t,{children:(h-1)*g+m+1}),e.jsx(t,{children:s.user?.name||"N/A"}),e.jsxs(t,{children:["ROOM"," ",s.room?s.room.room_number:"N/A"]}),e.jsx(t,{children:s.reportable_type}),e.jsx(t,{children:s.reportable_id}),e.jsx(t,{children:s.reportable_type==="peripheral"?s.reportable?.type:s.reportable_type==="system_unit"?"System Unit":s.reportable_type==="equipment"?s.reportable?.equipment_type:"N/A"}),e.jsx(t,{children:s.reportable_type==="peripheral"?s.reportable?.peripheral_code:s.reportable_type==="system_unit"?s.reportable?.unit_code:s.reportable_type==="equipment"?s.reportable?.equipment_code:"N/A"}),e.jsx(t,{children:s.condition}),e.jsx(t,{children:s.remarks}),e.jsx(t,{children:s.photo_url?e.jsx("img",{src:s.photo_url,alt:"Report",className:"w-16 h-16 object-cover rounded cursor-pointer hover:shadow-lg",onClick:()=>l(s.photo_url)}):"No photo"}),e.jsx(t,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(t,{children:e.jsx("div",{className:"flex gap-2",children:s.resolved?e.jsxs("span",{className:"text-sm font-medium text-green-600 flex items-center gap-1",children:[e.jsx(W,{className:"w-4 h-4"}),"Resolved"]}):e.jsxs(u,{size:"sm",variant:"secondary",className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",onClick:()=>ee(s),children:[e.jsx(W,{className:"w-4 h-4"}),"Resolve"]})})})]},s.id)):e.jsx(E,{children:e.jsx(t,{colSpan:"11",className:"text-center",children:"No reports found."})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mt-4 p-2 gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing"," ",j.length===0?0:(h-1)*g+1," ","â€“",Math.min(h*g,j.length)," ","of ",j.length," reports"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{variant:"outline",size:"sm",disabled:h===1,onClick:()=>V(h-1),children:"Previous"}),[...Array(q)].map((s,m)=>e.jsx(u,{variant:h===m+1?"default":"outline",size:"sm",onClick:()=>V(m+1),children:m+1},m)),e.jsx(u,{variant:"outline",size:"sm",disabled:h===q,onClick:()=>V(h+1),children:"Next"})]})]})]})})]})}),e.jsx($,{open:w,onOpenChange:_,children:e.jsxs(K,{className:"flex flex-col items-center",children:[e.jsx(X,{children:e.jsx(G,{children:"Report Photo"})}),i&&e.jsx("img",{src:i,alt:"Report",className:"max-w-full max-h-[80vh] object-contain rounded"})]})}),e.jsx($,{open:d,onOpenChange:v,children:e.jsxs(K,{className:"max-w-md w-full",children:[e.jsx(X,{children:e.jsxs(G,{children:["Resolve Report #",C?.id]})}),e.jsxs("div",{className:"flex flex-col gap-4 mt-2",children:[C?.remarks&&e.jsxs("div",{children:[e.jsx(I,{className:"text-gray-600",children:"Remarks"}),e.jsx("div",{className:"border rounded-md p-2 text-sm bg-gray-50",children:C.remarks})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Condition"}),e.jsxs(y,{value:F||C?.condition,onValueChange:D,children:[e.jsx(N,{children:e.jsx(R,{placeholder:"Select Condition"})}),e.jsxs(S,{children:[e.jsx(o,{value:"Functional",children:"Functional"}),e.jsx(o,{value:"Needs Repair",children:"Needs Repair"}),e.jsx(o,{value:"Replaced",children:"Replaced"}),e.jsx(o,{value:"Not Repairable",children:"Not Repairable"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Resolution Details"}),e.jsx(Q,{type:"text",placeholder:"Describe how you fixed it...",value:L,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx(u,{variant:"outline",onClick:()=>v(!1),disabled:A,children:"Cancel"}),e.jsx(u,{onClick:()=>se(C),variant:"secondary",disabled:A,children:A?"Saving...":"Save"})]})]})]})})]})]})}export{ts as default};
