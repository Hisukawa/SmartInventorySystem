import{r as l,u as B,j as e,a as c}from"./app-Cxk4xgnO.js";import{Q as D}from"./index-BM7NeAH4.js";import{S as m}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{T as ie}from"./technician-app-sidebar-Bh6nSvSC.js";import{B as le,a as ce,b as me,c as de}from"./breadcrumb-rRU8Uvzs.js";import{T as ue,a as he,b as E,c as d,d as pe,e as u}from"./table-B471uNb2.js";import{B as a}from"./button-D8DgmfUf.js";import{I as v}from"./input-D5-AuAzh.js";import{D as z,a as k,b as xe,c as O}from"./dialog-BFHdW51A.js";import{S as fe,a as ge,b as je,c as be}from"./avatar-D09hftzg.js";import{P as ve}from"./pen-BI8FDVV-.js";import{T as we}from"./trash-2-BCkeNVOR.js";import"./index-CaRkk-Uw.js";import"./index-Dxhvzti6.js";import"./index-D0YTxB9N.js";import"./index-CxUMiuQD.js";import"./chevron-right-D5pmuSOI.js";import"./createLucideIcon-CNVFR4Y9.js";import"./dropdown-menu-W3cW3YUK.js";import"./index-LQnm14NF.js";import"./utils-CBfrqCZ4.js";import"./house-GkYC3MJM.js";import"./user-vW5Znz6d.js";import"./log-out-CQEaXG2-.js";import"./boxes-Cv6adew_.js";import"./index-DDFofrqb.js";import"./index-DEpeWXlU.js";import"./index-DEBCuAIU.js";function Ze({rooms:r,search:q}){const[w,M]=l.useState(q||""),[N,p]=l.useState(!1),[A,h]=l.useState(!1),[I,L]=l.useState(null),[x,S]=l.useState(""),[f,C]=l.useState(""),[Q,y]=l.useState(!1),P=Array.isArray(r)?r:r?.data||[],{data:$,setData:H,post:U,reset:F,processing:K,errors:R}=B({room_number:""}),{data:X,setData:_,put:Y,processing:G,errors:T,reset:J}=B({room_number:""}),V=s=>{s.preventDefault(),U("/technician/rooms/create",{preserveScroll:!0,onSuccess:()=>{F(),p(!1),m.fire({title:"Room added successfully!",icon:"success",showConfirmButton:!1,timer:1500,customClass:{popup:"technician-success-message"}}).then(()=>{c.reload()})},onError:t=>{m.fire({title:t.room_number||"Error adding room",icon:"error",showConfirmButton:!0,customClass:{popup:"technician-success-message"}})}})},W=s=>{s.preventDefault(),Y(`/technician/rooms/${I.id}`,{preserveScroll:!0,onSuccess:()=>{h(!1),J(),m.fire({title:"Room updated successfully!",icon:"success",showConfirmButton:!1,timer:1500,customClass:{popup:"technician-success-message"}}).then(()=>{c.reload()})},onError:t=>{m.fire({title:t.room_number||"Error updating room",icon:"error",showConfirmButton:!0,customClass:{popup:"technician-success-message"}})}})},Z=s=>{L(s),_("room_number",s.room_number),h(!0)},ee=s=>{s.key==="Enter"&&c.get("/technician/rooms",{search:w})},se=(s,t)=>{s&&(S(s),C(t))},te=()=>{const s=document.getElementById("qr-download"),o=new XMLSerializer().serializeToString(s),g=new Blob([o],{type:"image/svg+xml;charset=utf-8"}),oe=URL.createObjectURL(g),j=new Image;j.onload=()=>{const n=document.createElement("canvas"),i=n.getContext("2d");n.width=220,n.height=260,i.fillStyle="#fff",i.fillRect(0,0,n.width,n.height),i.drawImage(j,10,10,200,200),i.fillStyle="#000",i.font="bold 16px sans-serif",i.textAlign="center",i.fillText(`ROOM ${f}`,n.width/2,235);const ne=n.toDataURL("image/png"),b=document.createElement("a");b.href=ne,b.download=`room-${f}-qr.png`,b.click()},j.src=oe},re=async()=>{await navigator.clipboard.writeText(x),y(!0),setTimeout(()=>y(!1),2e3)},ae=s=>{m.fire({title:"Are you sure?",text:"This room will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"}).then(t=>{t.isConfirmed&&c.delete(`/technician/rooms/${s}`,{preserveScroll:!0,onSuccess:()=>{m.fire({title:"Room deleted successfully!",icon:"success",showConfirmButton:!1,timer:1500,customClass:{popup:"technician-success-message"}}).then(()=>{c.reload()})}})})};return e.jsxs(fe,{children:[e.jsx(ie,{}),e.jsxs(ge,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 border-b bg-white",children:[e.jsx(je,{}),e.jsx(be,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(le,{children:e.jsx(ce,{children:e.jsx(me,{children:e.jsx(de,{href:"/technician/rooms","aria-current":"page",className:"font-semibold text-foreground",children:"Room Lists"})})})}),e.jsx("div",{className:"flex-1"})]}),e.jsxs("main",{className:"w-full px-6 py-4 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h1",{className:"text-xl font-bold",children:"Room Management"})}),e.jsx(z,{open:A,onOpenChange:h,children:e.jsxs(k,{children:[e.jsx(xe,{children:e.jsx(O,{children:"Edit Room"})}),e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsx(v,{placeholder:"e.g. 101",value:X.room_number,onChange:s=>_("room_number",s.target.value)}),T.room_number&&e.jsx("p",{className:"text-sm text-red-500",children:T.room_number}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(a,{type:"submit",disabled:G,children:"Update"})]})]})]})}),e.jsxs("div",{className:"flex transition-all duration-700 ease-in-out relative",children:[e.jsxs("div",{className:`flex-1 transition-all duration-700 ease-in-out ${N?"mr-[400px] sm:mr-[500px]":"mr-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-2",children:[e.jsx(v,{placeholder:"Search rooms...",value:w,onChange:s=>M(s.target.value),onKeyDown:ee,className:"w-full sm:w-1/3"}),e.jsx(a,{onClick:()=>p(!0),className:"bg-[hsl(142,31%,51%)] hover:bg-[hsl(142,31%,45%)] text-white font-medium",children:"Add Room"})]}),e.jsxs("div",{className:"rounded-md border",children:[e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(E,{className:"bg-[hsl(142,34%,85%)] text-[hsl(142,34%,25%)] hover:bg-[hsl(142,34%,80%)] h-10",children:[e.jsx(d,{children:"#"}),e.jsx(d,{children:"Room Name"}),e.jsx(d,{children:"Room Code"}),e.jsx(d,{children:"QR Code"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(pe,{children:P.map((s,t)=>{const o=typeof s.room_path=="string"?`${window.location.origin}/room/${s.room_path}`:null;return e.jsxs(E,{children:[e.jsx(u,{children:r?.current_page?(r.current_page-1)*r.per_page+t+1:t+1}),e.jsxs(u,{children:["ROOM ",s.room_number]}),e.jsx(u,{children:s.room_path}),e.jsx(u,{children:o?e.jsx("div",{className:"w-16 h-16 bg-white p-1 rounded cursor-pointer m-1",onClick:g=>{g.stopPropagation(),se(o,s.room_number)},children:e.jsx(D,{value:o,size:64})}):e.jsx("span",{className:"text-sm text-gray-500",children:"No QR"})}),e.jsxs(u,{className:"flex gap-2",children:[e.jsxs(a,{size:"sm",className:"flex items-center gap-2 bg-[hsl(142,34%,51%)] text-white border-none hover:bg-[hsl(142,34%,45%)]",onClick:()=>Z(s),children:[e.jsx(ve,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(a,{size:"sm",variant:"destructive",className:"flex items-center gap-2",onClick:()=>ae(s.id),children:[e.jsx(we,{className:"h-4 w-4"}),"Delete"]})]})]},s.id)})})]})}),e.jsxs("div",{className:"mt-2 flex flex-col sm:flex-row justify-between items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground m-2",children:["Page ",r.current_page," of ",r.last_page]}),r?.links&&e.jsx("div",{className:"flex flex-wrap justify-center items-center gap-2",children:r.links.map((s,t)=>{const o=s.label.replace("&laquo;","«").replace("&raquo;","»");return e.jsx(a,{variant:s.active?"default":"ghost",size:"sm",className:"min-w-[36px] px-3 py-1",onClick:()=>s.url&&c.visit(s.url,{preserveState:!0,preserveScroll:!0}),disabled:!s.url,dangerouslySetInnerHTML:{__html:o}},t)})})]})]})]}),e.jsxs("div",{className:`fixed top-[56px] right-0 h-[calc(100vh-4rem)] w-[400px] sm:w-[500px] bg-white border-l shadow-lg z-40 p-4 overflow-y-auto transform transition-transform duration-700 ease-in-out ${N?"translate-x-0":"translate-x-full"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Add Room"})}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsx(v,{placeholder:"e.g. 101",value:$.room_number,onChange:s=>H("room_number",s.target.value)}),R.room_number&&e.jsx("p",{className:"text-sm text-red-500",children:R.room_number}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(a,{type:"submit",disabled:K,className:"bg-[hsl(142,31%,51%)] hover:bg-[hsl(142,31%,45%)] text-white font-medium",children:"Save"})]})]})]})]}),e.jsx(z,{open:!!x,onOpenChange:()=>{S(""),C("")},children:e.jsxs(k,{className:"max-w-sm text-center",children:[e.jsxs(O,{children:["ROOM ",f]}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"inline-block p-4 bg-white rounded cursor-pointer",onClick:s=>{s.stopPropagation(),re()},children:[e.jsx(D,{id:"qr-download",value:x,size:200}),e.jsx("p",{className:"text-xs mt-2 text-muted-foreground",children:"Click QR to copy link"})]}),Q&&e.jsx("p",{className:"text-green-600 text-sm mt-1",children:"Copied to clipboard!"}),e.jsx(a,{className:"mt-4",onClick:te,children:"Download QR"})]})]})})]})]})]})}export{Ze as default};
