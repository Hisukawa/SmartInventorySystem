import{r as i,j as e,L as u,b as w,a as p}from"./app-3vLMqhnz.js";import{K as C}from"./transition-4oHmtf4t.js";import{n as x,d as k,T as F}from"./FaceMatcher-uHkuQCPQ.js";import{B as y}from"./button-wZybxZUW.js";import{C as L,b as D,c as R,a as S}from"./card-C8OiHDsj.js";import"./open-closed-O_30hLlc.js";import"./index-CfpO-yTh.js";import"./utils-CBfrqCZ4.js";const f=i.createContext(),c=({children:t})=>{const[s,r]=i.useState(!1),o=()=>{r(a=>!a)};return e.jsx(f.Provider,{value:{open:s,setOpen:r,toggleOpen:o},children:e.jsx("div",{className:"relative",children:t})})},T=({children:t})=>{const{open:s,setOpen:r,toggleOpen:o}=i.useContext(f);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:o,children:t}),s&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1)})]})},O=({align:t="right",width:s="48",contentClasses:r="py-1 bg-white",children:o})=>{const{open:a,setOpen:d}=i.useContext(f);let l="origin-top";t==="left"?l="ltr:origin-top-left rtl:origin-top-right start-0":t==="right"&&(l="ltr:origin-top-right rtl:origin-top-left end-0");let m="";return s==="48"&&(m="w-48"),e.jsx(e.Fragment,{children:e.jsx(C,{show:a,enter:"transition ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx("div",{className:`absolute z-50 mt-2 rounded-md shadow-lg ${l} ${m}`,onClick:()=>d(!1),children:e.jsx("div",{className:"rounded-md ring-1 ring-black ring-opacity-5 "+r,children:o})})})})},M=({className:t="",children:s,...r})=>e.jsx(u,{...r,className:"block w-full px-4 py-2 text-start text-sm leading-5 text-gray-700 transition duration-150 ease-in-out hover:bg-gray-100 focus:bg-gray-100 focus:outline-none "+t,children:s});c.Trigger=T;c.Content=O;c.Link=M;function P({active:t=!1,className:s="",children:r,...o}){return e.jsx(u,{...o,className:"inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium leading-5 transition duration-150 ease-in-out focus:outline-none "+(t?"border-indigo-400 text-gray-900 focus:border-indigo-700":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 focus:border-gray-300 focus:text-gray-700")+s,children:r})}function h({active:t=!1,className:s="",children:r,...o}){return e.jsx(u,{...o,className:`flex w-full items-start border-l-4 py-2 pe-4 ps-3 ${t?"border-indigo-400 bg-indigo-50 text-indigo-700 focus:border-indigo-700 focus:bg-indigo-100 focus:text-indigo-800":"border-transparent text-gray-600 hover:border-gray-300 hover:bg-gray-50 hover:text-gray-800 focus:border-gray-300 focus:bg-gray-50 focus:text-gray-800"} text-base font-medium transition duration-150 ease-in-out focus:outline-none ${s}`,children:r})}function A({header:t,children:s}){const r=w().props.auth.user,[o,a]=i.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsxs("nav",{className:"border-b border-gray-100 bg-white",children:[e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex h-16 justify-between",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex shrink-0 items-center",children:e.jsx(u,{href:"/"})}),e.jsx("div",{className:"hidden space-x-8 sm:-my-px sm:ms-10 sm:flex",children:e.jsx(P,{href:route("admin.dashboard"),active:route().current("admin.dashboard"),children:"Dashboard"})})]}),e.jsx("div",{className:"hidden sm:ms-6 sm:flex sm:items-center",children:e.jsx("div",{className:"relative ms-3",children:e.jsxs(c,{children:[e.jsx(c.Trigger,{children:e.jsx("span",{className:"inline-flex rounded-md",children:e.jsxs("button",{type:"button",className:"inline-flex items-center rounded-md border border-transparent bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-500 transition duration-150 ease-in-out hover:text-gray-700 focus:outline-none",children:[r.name,e.jsx("svg",{className:"-me-0.5 ms-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})}),e.jsx(c.Content,{children:e.jsx(c.Link,{href:route("logout"),method:"post",as:"button",children:"Log Out"})})]})})}),e.jsx("div",{className:"-me-2 flex items-center sm:hidden",children:e.jsx("button",{onClick:()=>a(d=>!d),className:"inline-flex items-center justify-center rounded-md p-2 text-gray-400 transition duration-150 ease-in-out hover:bg-gray-100 hover:text-gray-500 focus:bg-gray-100 focus:text-gray-500 focus:outline-none",children:e.jsxs("svg",{className:"h-6 w-6",stroke:"currentColor",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("path",{className:o?"hidden":"inline-flex",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"}),e.jsx("path",{className:o?"inline-flex":"hidden",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})]})})})]})}),e.jsxs("div",{className:(o?"block":"hidden")+" sm:hidden",children:[e.jsx("div",{className:"space-y-1 pb-3 pt-2",children:e.jsx(h,{href:route("dashboard"),active:route().current("dashboard"),children:"Dashboard"})}),e.jsxs("div",{className:"border-t border-gray-200 pb-1 pt-4",children:[e.jsxs("div",{className:"px-4",children:[e.jsx("div",{className:"text-base font-medium text-gray-800",children:r.name}),e.jsx("div",{className:"text-sm font-medium text-gray-500",children:r.email})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsx(h,{href:route("profile.edit"),children:"Profile"}),e.jsx(h,{method:"post",href:route("logout"),as:"button",children:"Log Out"})]})]})]})]}),t&&e.jsx("header",{className:"bg-white shadow",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8",children:t})}),e.jsx("main",{children:s})]})}const E=t=>t.charAt(0).toUpperCase()+t.slice(1);function V({user:t}){const s=i.useRef(),r=i.useRef(),[o,a]=i.useState("Loading models..."),[d,l]=i.useState(!1);i.useEffect(()=>{m()},[]);async function m(){try{await x.tinyFaceDetector.loadFromUri("/models"),await x.faceRecognitionNet.loadFromUri("/models"),await x.faceLandmark68TinyNet.loadFromUri("/models"),a("Models loaded! Starting camera..."),b()}catch(n){console.error("Model loading error:",n),a("âš ï¸ Error loading models. Check console.")}}async function b(){try{const n=await navigator.mediaDevices.getUserMedia({video:!0});s.current.srcObject=n,a("Camera ready! Look directly at the camera.")}catch(n){console.error("Camera access error:",n),a("Please allow camera access to continue.")}}async function j(){l(!0),a("Detecting face...");try{const n=await k(s.current,new F).withFaceLandmarks(!0).withFaceDescriptor();if(!n){a("âŒ No face detected. Please try again."),l(!1);return}const v=Array.from(n.descriptor);a("âœ… Face detected! Saving...");const g=await(await fetch("/register-face",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({descriptor:v}),credentials:"include"})).json();if(g.success){a("ðŸŽ‰ Face registered successfully!");const N={admin:"/admin/dashboard",faculty:"/faculty/dashboard",technician:"/technician/dashboard"}[g.role]||"/dashboard";setTimeout(()=>p.visit(N),1500)}else a("âŒ Failed to save face data. Try again.")}catch(n){console.error("Detection error:",n),a("âš ï¸ Error detecting face. Check console.")}l(!1)}return e.jsx(A,{header:e.jsx("h2",{className:"text-2xl font-semibold leading-tight text-gray-800 text-center",children:t?.role?`${E(t.role)} Profile`:"Admin Profile"}),children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[80vh] bg-gradient-to-br from-gray-100 via-gray-50 to-gray-100 p-4",children:e.jsxs(L,{className:"max-w-md w-full shadow-2xl rounded-3xl backdrop-blur-md bg-white/60 overflow-hidden",children:[e.jsx(D,{className:"bg-gray-100 text-center py-4",children:e.jsx(R,{className:"text-2xl font-bold",children:"Register Your Face"})}),e.jsxs(S,{className:"flex flex-col items-center gap-6 p-6 relative",children:[e.jsxs("div",{className:"relative w-64 h-64 rounded-full overflow-hidden border-4 border-gray-300 shadow-lg ring-2 ring-indigo-500 ring-offset-2 ring-offset-white animate-pulse",children:[e.jsx("video",{ref:s,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("div",{ref:r,className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-44 h-44 border-2 border-dashed border-indigo-400 rounded-full"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full justify-center mt-4",children:[e.jsx(y,{type:"button",onClick:j,disabled:d,className:"flex-1 sm:flex-none shadow-md",children:d?"Processing...":"Capture & Save Face"}),e.jsx(y,{type:"button",variant:"outline",onClick:()=>p.visit("/profile"),className:"flex-1 sm:flex-none",children:"Back"})]}),e.jsx("p",{className:"text-gray-700 text-sm text-center mt-2 font-medium",children:o})]})]})})})}export{V as default};
