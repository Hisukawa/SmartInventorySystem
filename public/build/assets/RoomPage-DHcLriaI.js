import{r as a,u as y,j as e,a as x}from"./app-Bkk0CQzs.js";import{Q as T}from"./index-CXBTIPQH.js";import{S as u}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{T as W,a as Z,b as _,c,d as ee,e as d}from"./table-6B1---U8.js";import{I as B,B as i}from"./input-DCq-UUra.js";import{D,a as z,b as se,c as E}from"./dialog-cBAOuFqM.js";import{S as te,A as ae,a as re,b as ne,c as oe,B as ie,d as le,e as ce,f as de}from"./breadcrumb-CkhfQ9Q6.js";import"./index-DYIMs562.js";import"./index-Q8sKNiyw.js";import"./index-BfmKmxZ0.js";import"./index-DFOZdcsu.js";function _e({rooms:l,search:k}){const[b,M]=a.useState(k||""),[me,xe]=a.useState(!1),[O,m]=a.useState(!1),[q,I]=a.useState(null),[h,w]=a.useState(""),[p,S]=a.useState(""),[Q,v]=a.useState(!1),[R,ue]=a.useState("");y({room_number:""});const{data:L,setData:C,put:A,processing:P,errors:N,reset:H}=y({room_number:""}),$=s=>{s.preventDefault(),A(`/admin/rooms/${q.id}`,{preserveScroll:!0,onSuccess:()=>{m(!1),H(),u.fire({icon:"success",title:"Room updated!",showConfirmButton:!1,timer:1500})},onError:()=>{u.fire({icon:"error",title:"Update failed!",text:"Please check your input."})}})},U=s=>{I(s),C("room_number",s.room_number),m(!0)},F=s=>{s.key==="Enter"&&x.get("/admin/rooms",{search:b})},K=(s,t)=>{s&&(w(s),S(t))},X=()=>{const s=document.getElementById("qr-download"),r=new XMLSerializer().serializeToString(s),g=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),J=URL.createObjectURL(g),f=new Image;f.onload=()=>{const n=document.createElement("canvas"),o=n.getContext("2d");n.width=220,n.height=260,o.fillStyle="#fff",o.fillRect(0,0,n.width,n.height),o.drawImage(f,10,10,200,200),o.fillStyle="#000",o.font="bold 16px sans-serif",o.textAlign="center",o.fillText(`ROOM ${p}`,n.width/2,235);const V=n.toDataURL("image/png"),j=document.createElement("a");j.href=V,j.download=`room-${p}-qr.png`,j.click()},f.src=J},Y=async()=>{await navigator.clipboard.writeText(h),v(!0),setTimeout(()=>v(!1),2e3)},G=s=>{u.fire({title:"Are you sure?",text:"This room will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"}).then(t=>{t.isConfirmed&&x.delete(`/admin/rooms/${s}`,{preserveScroll:!0,onSuccess:()=>{u.fire({icon:"success",title:"Deleted!",text:"The room has been deleted.",timer:1500,showConfirmButton:!1})}})})};return e.jsxs(te,{children:[e.jsx(ae,{}),e.jsxs(re,{children:[e.jsxs("header",{className:"flex h-16 items-center gap-2 px-4 border-b bg-white",children:[e.jsx(ne,{}),e.jsx(oe,{orientation:"vertical",className:"h-6 mx-3"}),e.jsx(ie,{children:e.jsx(le,{children:e.jsx(ce,{children:e.jsx(de,{href:"/admin/rooms","aria-current":"page",className:"font-semibold text-foreground",children:"Room Lists"})})})})]}),e.jsxs("main",{className:"w-full px-6 py-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h1",{className:"text-xl font-bold",children:"Room Management"})}),R&&e.jsx("div",{className:"mb-4 p-3 bg-green-100 text-green-800 rounded shadow text-sm",children:R}),e.jsx(D,{open:O,onOpenChange:m,children:e.jsxs(z,{children:[e.jsx(se,{children:e.jsx(E,{children:"Edit Room"})}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsx(B,{placeholder:"e.g. 101",value:L.room_number,onChange:s=>C("room_number",s.target.value)}),N.room_number&&e.jsx("p",{className:"text-sm text-red-500",children:N.room_number}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:P,children:"Update"})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(B,{placeholder:"Search rooms...",value:b,onChange:s=>M(s.target.value),onKeyDown:F,className:"mb-4 w-full sm:w-1/3"}),e.jsx(i,{onClick:()=>x.visit("/admin/rooms/create"),children:"Add Room"})]}),e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(W,{children:[e.jsx(Z,{children:e.jsxs(_,{children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"Room Name"}),e.jsx(c,{children:"Room Code"}),e.jsx(c,{children:"QR Code"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ee,{children:l.data.map((s,t)=>{const r=typeof s.room_path=="string"?`${window.location.origin}/room/${s.room_path}`:null;return e.jsxs(_,{children:[e.jsx(d,{children:(l.current_page-1)*l.per_page+t+1}),e.jsxs(d,{children:["ROOM ",s.room_number]}),e.jsx(d,{children:s.room_path}),e.jsx(d,{children:r?e.jsx("div",{className:"w-16 h-16 bg-white p-1 rounded cursor-pointer m-1",onClick:g=>{g.stopPropagation(),K(r,s.room_number)},children:e.jsx(T,{value:r,size:64})}):e.jsx("span",{className:"text-sm text-gray-500",children:"No QR"})}),e.jsxs(d,{children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>U(s),className:"mr-2",children:"Edit"}),e.jsx(i,{variant:"destructive",size:"sm",onClick:()=>G(s.id),children:"Delete"})]})]},s.id)})})]}),e.jsxs("div",{className:"mt-2 flex flex-col sm:flex-row justify-between items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground m-2",children:["Page ",l.current_page," of ",l.last_page]}),e.jsx("div",{className:"flex flex-wrap justify-center items-center gap-2",children:l.links.map((s,t)=>{const r=s.label.replace("&laquo;","«").replace("&raquo;","»");return e.jsx(i,{variant:s.active?"default":"ghost",size:"sm",className:"min-w-[36px] px-3 py-1",onClick:()=>s.url&&x.visit(s.url),disabled:!s.url,dangerouslySetInnerHTML:{__html:r}},t)})})]})]}),e.jsx(D,{open:!!h,onOpenChange:()=>{w(""),S("")},children:e.jsxs(z,{className:"max-w-sm text-center",children:[e.jsxs(E,{children:["ROOM ",p]}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"inline-block p-4 bg-white rounded cursor-pointer",onClick:s=>{s.stopPropagation(),Y()},children:[e.jsx(T,{id:"qr-download",value:h,size:200}),e.jsx("p",{className:"text-xs mt-2 text-muted-foreground",children:"Click QR to copy link"})]}),Q&&e.jsx("p",{className:"text-green-600 text-sm text-center mt-1",children:"Copied to clipboard!"}),e.jsx(i,{className:"mt-4",onClick:X,children:"Download QR"})]})]})})]})]})]})}export{_e as default};
