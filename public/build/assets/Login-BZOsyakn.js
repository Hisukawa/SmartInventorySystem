import{r as a,j as e,u as K,H as X}from"./app-CIxngH2t.js";import{n as P,d as $,T as Y}from"./FaceMatcher-uHkuQCPQ.js";import{b as Q,c as W,d as Z}from"./card-CNvxXNpe.js";import{I as O}from"./input-DManFQ7U.js";import{L as R}from"./label-Cn8JbmtK.js";import{B as I}from"./button-BFvGhadS.js";import{u as A}from"./index-DDZVC9IK.js";import{c as ee,d as te,P as _,a as re,b as D}from"./index-DlOAqtH9.js";import{u as se}from"./index-lCKA-pQ8.js";import{u as ae,C as oe}from"./index-CZkxrXvq.js";import{c as M}from"./utils-CBfrqCZ4.js";import"./createLucideIcon-kaK51N8a.js";var F="Checkbox",[ne,Ce]=ee(F),[ce,T]=ne(F);function ie(s){const{__scopeCheckbox:n,checked:o,children:p,defaultChecked:l,disabled:t,form:b,name:f,onCheckedChange:m,required:w,value:u="on",internal_do_not_use_render:h}=s,[x,c]=re({prop:o,defaultProp:l??!1,onChange:m,caller:F}),[g,v]=a.useState(null),[j,i]=a.useState(null),d=a.useRef(!1),N=g?!!b||!!g.closest("form"):!0,r={checked:x,disabled:t,setChecked:c,control:g,setControl:v,name:f,form:b,value:u,hasConsumerStoppedPropagationRef:d,required:w,defaultChecked:C(l)?!1:l,isFormControl:N,bubbleInput:j,setBubbleInput:i};return e.jsx(ce,{scope:n,...r,children:le(h)?h(r):p})}var B="CheckboxTrigger",U=a.forwardRef(({__scopeCheckbox:s,onKeyDown:n,onClick:o,...p},l)=>{const{control:t,value:b,disabled:f,checked:m,required:w,setControl:u,setChecked:h,hasConsumerStoppedPropagationRef:x,isFormControl:c,bubbleInput:g}=T(B,s),v=A(l,u),j=a.useRef(m);return a.useEffect(()=>{const i=t?.form;if(i){const d=()=>h(j.current);return i.addEventListener("reset",d),()=>i.removeEventListener("reset",d)}},[t,h]),e.jsx(_.button,{type:"button",role:"checkbox","aria-checked":C(m)?"mixed":m,"aria-required":w,"data-state":J(m),"data-disabled":f?"":void 0,disabled:f,value:b,...p,ref:v,onKeyDown:D(n,i=>{i.key==="Enter"&&i.preventDefault()}),onClick:D(o,i=>{h(d=>C(d)?!0:!d),g&&c&&(x.current=i.isPropagationStopped(),x.current||i.stopPropagation())})})});U.displayName=B;var L=a.forwardRef((s,n)=>{const{__scopeCheckbox:o,name:p,checked:l,defaultChecked:t,required:b,disabled:f,value:m,onCheckedChange:w,form:u,...h}=s;return e.jsx(ie,{__scopeCheckbox:o,checked:l,defaultChecked:t,disabled:f,required:b,onCheckedChange:w,name:p,form:u,value:m,internal_do_not_use_render:({isFormControl:x})=>e.jsxs(e.Fragment,{children:[e.jsx(U,{...h,ref:n,__scopeCheckbox:o}),x&&e.jsx(z,{__scopeCheckbox:o})]})})});L.displayName=F;var q="CheckboxIndicator",H=a.forwardRef((s,n)=>{const{__scopeCheckbox:o,forceMount:p,...l}=s,t=T(q,o);return e.jsx(te,{present:p||C(t.checked)||t.checked===!0,children:e.jsx(_.span,{"data-state":J(t.checked),"data-disabled":t.disabled?"":void 0,...l,ref:n,style:{pointerEvents:"none",...s.style}})})});H.displayName=q;var V="CheckboxBubbleInput",z=a.forwardRef(({__scopeCheckbox:s,...n},o)=>{const{control:p,hasConsumerStoppedPropagationRef:l,checked:t,defaultChecked:b,required:f,disabled:m,name:w,value:u,form:h,bubbleInput:x,setBubbleInput:c}=T(V,s),g=A(o,c),v=se(t),j=ae(p);a.useEffect(()=>{const d=x;if(!d)return;const N=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(N,"checked").set,y=!l.current;if(v!==t&&k){const S=new Event("click",{bubbles:y});d.indeterminate=C(t),k.call(d,C(t)?!1:t),d.dispatchEvent(S)}},[x,v,t,l]);const i=a.useRef(C(t)?!1:t);return e.jsx(_.input,{type:"checkbox","aria-hidden":!0,defaultChecked:b??i.current,required:f,disabled:m,name:w,value:u,form:h,...n,tabIndex:-1,ref:g,style:{...n.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});z.displayName=V;function le(s){return typeof s=="function"}function C(s){return s==="indeterminate"}function J(s){return C(s)?"indeterminate":s?"checked":"unchecked"}const G=a.forwardRef(({className:s,...n},o)=>e.jsx(L,{ref:o,className:M("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:e.jsx(H,{className:M("flex items-center justify-center text-current"),children:e.jsx(oe,{className:"h-4 w-4"})})}));G.displayName=L.displayName;function je({status:s}){const{data:n,setData:o,post:p,processing:l,errors:t,reset:b}=K({email:"",password:"",remember:!1}),f=a.useRef(null),[m,w]=a.useState(!1),[u,h]=a.useState(!1),[x,c]=a.useState(""),[g,v]=a.useState(!1);a.useEffect(()=>{(async()=>{try{await P.tinyFaceDetector.loadFromUri("/models"),await P.faceRecognitionNet.loadFromUri("/models"),await P.faceLandmark68TinyNet.loadFromUri("/models"),w(!0)}catch(k){console.error(k)}})()},[]);const j=async()=>{if(!m){c("â³ Models are still loading...");return}try{const r=await navigator.mediaDevices.getUserMedia({video:!0});f.current.srcObject=r,h(!0),c("ðŸŽ¥ Camera started. Please look straight at the camera.")}catch(r){console.error(r),c("âš ï¸ Please allow camera access to continue.")}},i=async()=>{if(!u){c("âš ï¸ Please start the camera first.");return}v(!0),c("ðŸ” Detecting face...");try{const r=await $(f.current,new Y).withFaceLandmarks(!0).withFaceDescriptor();if(!r){c("âŒ No face detected. Please try again."),v(!1);return}const k=Array.from(r.descriptor),y=window.location.href;await d(k,y)}catch(r){console.error("Face detection error:",r),c("âŒ Error detecting face.")}finally{v(!1)}},d=async(r,k)=>{try{const y=await fetch("/verify-face",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({descriptor:r})}),S=await y.text();let E;try{E=JSON.parse(S)}catch{throw console.error("Invalid JSON from server:",S),new Error("Server returned invalid response (not JSON)")}if(!y.ok)throw new Error(E.message||"Face verification failed");E.success?(c("âœ… Face verified successfully!"),window.location.href=E.redirect_url):c("âŒ Face not recognized. Please try again.")}catch(y){console.error("Face verification error:",y),c(`âš ï¸ ${y.message}`)}},N=r=>{r.preventDefault(),p(route("login"),{onFinish:()=>b("password")})};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Log in"}),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 px-4",children:e.jsxs("div",{className:"w-full max-w-5xl grid grid-cols-1 md:grid-cols-2 bg-white shadow-lg rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"hidden md:flex flex-col items-center justify-center bg-green-500 text-white p-8 relative",children:[e.jsxs("div",{className:"flex space-x-4 mb-6",children:[e.jsx("div",{className:"w-28 h-28 rounded-full overflow-hidden border-4 border-white bg-white shadow-md",children:e.jsx("img",{src:"logo.png",alt:"Logo 1",className:"w-full h-full object-contain"})}),e.jsx("div",{className:"w-28 h-28 rounded-full overflow-hidden border-4 border-white bg-white shadow-md",children:e.jsx("img",{src:"/ict.png",alt:"Logo 2",className:"w-full h-full object-contain"})})]}),e.jsx("h2",{className:"text-2xl font-bold text-center",children:"ICT INVENTORY SYSTEM MANAGEMENT"}),e.jsx("p",{className:"mt-3 text-sm opacity-90 text-center",children:"Secure â€¢ Fast â€¢ Organized"})]}),e.jsxs("div",{className:"p-8 flex flex-col justify-center",children:[e.jsxs(Q,{className:"p-0 mb-6",children:[e.jsx(W,{className:"text-2xl font-bold",children:"Login Account"}),e.jsx(Z,{children:"Please enter your details or login with your face"})]}),s&&e.jsx("div",{className:"mb-4 text-sm font-medium text-green-600",children:s}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(R,{htmlFor:"email",children:"Email Address"}),e.jsx(O,{id:"email",type:"email",name:"email",value:n.email,autoComplete:"username",onChange:r=>o("email",r.target.value)}),t.email&&e.jsx("p",{className:"text-sm text-red-500",children:t.email})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(R,{htmlFor:"password",children:"Password"}),e.jsx(O,{id:"password",type:"password",name:"password",value:n.password,autoComplete:"current-password",onChange:r=>o("password",r.target.value)}),t.password&&e.jsx("p",{className:"text-sm text-red-500",children:t.password})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{id:"remember",checked:n.remember,onCheckedChange:r=>o("remember",!!r)}),e.jsx("label",{htmlFor:"remember",className:"text-sm text-muted-foreground",children:"Remember me"})]}),e.jsx(I,{type:"submit",className:"w-full mt-2 bg-green-500 hover:bg-green-600 text-white",disabled:l,children:"Login"})]}),e.jsx("hr",{className:"my-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{children:"Login with Face"}),e.jsxs("div",{className:`relative mx-auto transition-all duration-300 ${u?"w-64 h-64 opacity-100 scale-100":"w-0 h-0 opacity-0 scale-0"}`,children:[e.jsx("video",{ref:f,autoPlay:!0,muted:!0,className:"w-full h-full rounded-full border-4 border-green-500 object-cover"}),e.jsx("div",{className:"absolute inset-0 border-4 border-dashed border-green-300 rounded-full pointer-events-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:"button",onClick:j,disabled:u||!m,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:u?"Camera On":"Start Camera"}),e.jsx(I,{type:"button",onClick:i,disabled:!u||g,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:g?"Verifying...":"Verify Face"})]}),e.jsx("p",{className:"text-sm text-gray-600 text-center mt-2",children:x})]}),e.jsxs("div",{className:"text-center text-sm mt-6",children:["Donâ€™t have an account?"," ",e.jsx("span",{className:"text-gray-600",children:"Please contact the ICT Department Chairperson to request one."})]})]})]})})]})}export{je as default};
